<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FAQ &mdash; MicroEleX 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js?v=5d32c60e"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../_static/documentation_options.js?v=f2a433a1"></script>
        <script src="../_static/doctools.js?v=9a2dae69"></script>
        <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../_static/design-tabs.js?v=36754332"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MicroEleX
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/users.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/cmake.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/hpc.html">HPC</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">USAGE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="how_to_run.html">Run WarpX</a></li>
<li class="toctree-l1"><a class="reference internal" href="domain_decomposition.html">Domain Decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Input Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="python.html">Python (PICMI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="examples.html">Examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DATA ANALYSIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/formats.html">Output formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/yt.html">yt-project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/openpmdviewer.html">openPMD-viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/openpmdapi.html">openPMD-api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/paraview.html">3D Visualization: ParaView</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/visit.html">3D Visualization: VisIt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/visualpic.html">VisualPIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/picviewer.html">PICViewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/reduced_diags.html">Reduced diagnostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../dataanalysis/workflows.html">Workflows</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">EPILOGUE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Funding and Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MicroEleX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">FAQ</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/usage/faq.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="faq">
<span id="usage-faq"></span><h1>FAQ<a class="headerlink" href="#faq" title="Link to this heading"></a></h1>
<p>This section lists frequently asked usage questions.</p>
<section id="what-is-mpi-initialized-with-thread-support-level">
<h2>What is “MPI initialized with thread support level …”?<a class="headerlink" href="#what-is-mpi-initialized-with-thread-support-level" title="Link to this heading"></a></h2>
<p>When we start up WarpX, we report a couple of information on used MPI processes across parallel compute processes, CPU threads or GPUs and further capabilities.
For instance, a parallel, multi-process, multi-threaded CPU run could output:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">MPI</span><span class="w"> </span><span class="n">initialized</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="n">MPI</span><span class="w"> </span><span class="n">processes</span>
<span class="n">MPI</span><span class="w"> </span><span class="n">initialized</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="kr">thread</span><span class="w"> </span><span class="n">support</span><span class="w"> </span><span class="n">level</span><span class="w"> </span><span class="mi">3</span>
<span class="n">OMP</span><span class="w"> </span><span class="n">initialized</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="mi">8</span><span class="w"> </span><span class="n">OMP</span><span class="w"> </span><span class="n">threads</span>
<span class="n">AMReX</span><span class="w"> </span><span class="p">(</span><span class="mf">22.10</span><span class="mi">-20</span><span class="o">-</span><span class="n">g3082028e4287</span><span class="p">)</span><span class="w"> </span><span class="n">initialized</span>
<span class="p">...</span>
</pre></div>
</div>
<p>The 1st line is the number of parallel MPI processes (also called <em>MPI ranks</em>).</p>
<p>The 2nd line reports on the <a class="reference external" href="https://www.mpich.org/static/docs/v3.1/www3/MPI_Init_thread.html">support level of MPI functions to be called from threads</a>.
We currently only use this for optional, <a class="reference internal" href="parameters.html#running-cpp-parameters-diagnostics"><span class="std std-ref">async IO with AMReX plotfiles</span></a>.
In the past, requesting MPI threading support had performance penalties, but we have not seen such anymore on recent systems.
Thus, we request it by default but you can overwrite it with a <a class="reference internal" href="../install/cmake.html#building-cmake-options"><span class="std std-ref">compile time option</span></a> if it ever becomes needed.</p>
<p>The 3rd line is the number of CPU OpenMP (OMP) threads per MPI process.
After that, information on software versions follow.</p>
</section>
<section id="how-do-i-suppress-tiny-profiler-output-if-i-do-not-care-to-see-it">
<h2>How do I suppress tiny profiler output if I do not care to see it?<a class="headerlink" href="#how-do-i-suppress-tiny-profiler-output-if-i-do-not-care-to-see-it" title="Link to this heading"></a></h2>
<p>Via <code class="docutils literal notranslate"><span class="pre">AMReX_TINY_PROFILE=OFF</span></code> (see: <a class="reference internal" href="../install/cmake.html#building-cmake-options"><span class="std std-ref">build options</span></a> and then <a class="reference external" href="https://amrex-codes.github.io/amrex/docs_html/BuildingAMReX.html#customization-options">AMReX build options</a>).
We change the default in <code class="docutils literal notranslate"><span class="pre">cmake/dependencies/AMReX.cmake</span></code>.</p>
<p>Note that the tiny profiler adds literally no overhead to the simulation runtime, thus we enable it by default.</p>
</section>
<section id="what-design-principles-should-i-keep-in-mind-when-creating-an-input-file">
<h2>What design principles should I keep in mind when creating an input file?<a class="headerlink" href="#what-design-principles-should-i-keep-in-mind-when-creating-an-input-file" title="Link to this heading"></a></h2>
<p>Leave a cushion between lasers, particles, and the edge of computational domain.
The laser antenna and plasma species <code class="docutils literal notranslate"><span class="pre">zmin</span></code> can be less than or greater than  the <code class="docutils literal notranslate"><span class="pre">geometry.prob_hi</span></code>,
but not exactly equal.</p>
</section>
<section id="what-do-i-need-to-know-about-using-the-boosted-frame">
<h2>What do I need to know about using the boosted frame?<a class="headerlink" href="#what-do-i-need-to-know-about-using-the-boosted-frame" title="Link to this heading"></a></h2>
<p>The input deck can be designed in the lab frame and little modification to the physical set-up is needed –
most of the work is done internally.
Here are a few practical items to assist in designing boosted frame simulations:</p>
<ul class="simple">
<li><p>Ions must be explicitly included</p></li>
<li><p>Best practice is to separate counter-propagating objects; things moving to the right should start with <span class="math notranslate nohighlight">\(z &lt;= 0\)</span> and things stationary or moving to the left (moving to the left in the boosted frame) should start with <span class="math notranslate nohighlight">\(z &gt; 0\)</span></p></li>
<li><p>Don’t forget the general design principles listed above</p></li>
<li><p>The boosted frame simulation begins at boosted time <span class="math notranslate nohighlight">\(t'=0\)</span></p></li>
<li><p>Numerics and algorithms need to be adjusted, as there are numerical instabilities that arise in the boosted frame. For example, setting <code class="docutils literal notranslate"><span class="pre">particles.use_fdtd_nci_corr=1</span></code> for an FDTD simulation or setting <code class="docutils literal notranslate"><span class="pre">psatd.use_default_v_galilean=1</span></code> for a PSATD simulation. Be careful as this is overly simplistic and these options will not work in all cases.  Please see the <a class="reference internal" href="parameters.html#running-cpp-parameters"><span class="std std-ref">input parameters documentation</span></a> and the <a class="reference internal" href="examples.html#usage-examples"><span class="std std-ref">examples</span></a> for more information</p></li>
</ul>
<p>An in-depth discussion of the boosted frame is provided in the <a class="reference internal" href="../theory/boosted_frame.html#theory-boostedframe"><span class="std std-ref">moving window and optimal Lorentz boosted frame</span></a> section.</p>
</section>
<section id="what-about-back-transformed-diagnostics-btd">
<h2>What about Back-transformed diagnostics (BTD)?<a class="headerlink" href="#what-about-back-transformed-diagnostics-btd" title="Link to this heading"></a></h2>
<figure class="align-default" id="id1">
<img alt="[fig:BTD_features] Minkowski diagram indicating several features of the back-transformed diagnostic (BTD). The diagram explains why the first BTD begins to fill at boosted time :math:`t'=0` but this doesn't necessarily correspond to lab time :math:`t=0`, how the BTD grid-spacing is determined by the boosted time step :math:`\Delta t'`, hence why the snapshot length don't correspond to the grid spacing and length in the input script, and how the BTD snapshots complete when the effective snapshot length is covered in the boosted frame." src="https://user-images.githubusercontent.com/10621396/198702232-9dd595ad-479e-4170-bd25-51e2b72cd50a.png" />
<figcaption>
<p><span class="caption-text">[fig:BTD_features] Minkowski diagram indicating several features of the back-transformed diagnostic (BTD). The diagram explains why the first BTD begins to fill at boosted time <span class="math notranslate nohighlight">\(t'=0\)</span> but this doesn’t necessarily correspond to lab time <span class="math notranslate nohighlight">\(t=0\)</span>, how the BTD grid-spacing is determined by the boosted time step <span class="math notranslate nohighlight">\(\Delta t'\)</span>, hence why the snapshot length don’t correspond to the grid spacing and length in the input script, and how the BTD snapshots complete when the effective snapshot length is covered in the boosted frame.</span><a class="headerlink" href="#id1" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>Several BTD quantities differ slightly from the lab frame domain described in the input deck.
In the following discussion, we will use a subscript input (e.g. <span class="math notranslate nohighlight">\(\Delta z_{\rm input}\)</span>) to denote properties of the lab frame domain.</p>
<ul class="simple">
<li><p>The first back-transformed diagnostic (BTD) snapshot may not occur at <span class="math notranslate nohighlight">\(t=0\)</span>. Rather, it occurs at <span class="math notranslate nohighlight">\(t_0=\frac{z_{max}}c \beta(1+\beta)\gamma^2\)</span>. This is the first time when the boosted frame can complete the snapshot.</p></li>
<li><p>The grid spacing of the BTD snapshot is different from the grid spacing indicated in the input script. It is given by <span class="math notranslate nohighlight">\(\Delta z_{\rm grid,snapshot}=\frac{c\Delta t_{\rm boost}}{\gamma\beta}\)</span>.  For a CFL-limited time step, <span class="math notranslate nohighlight">\(\Delta z_{\rm grid,snapshot}\approx \frac{1+\beta}{\beta} \Delta z_{\rm input}\approx 2 \Delta z_{\rm input}\)</span>. Hence in many common use cases at large boost, it is expected that the BTD snapshot has a grid spacing twice what is expressed in the input script.</p></li>
<li><p>The effective length of the BTD snapshot may be longer than anticipated from the input script because the grid spacing is different. Additionally, the number of grid points in the BTD snapshot is a multiple of <code class="docutils literal notranslate"><span class="pre">&lt;BTD&gt;.buffer_size</span></code> whereas the number of grid cells specified in the input deck may not be.</p></li>
<li><p>The code may require longer than anticipated to complete a BTD snapshot. The code starts filling the <span class="math notranslate nohighlight">\(i^{th}\)</span> snapshot around step <span class="math notranslate nohighlight">\(j_{\rm BTD start}={\rm ceil}\left( i\gamma(1-\beta)\frac{\Delta t_{\rm snapshot}}{\Delta t_{\rm boost}}\right)\)</span>. The code then saves information for one BTD cell every time step in the boosted frame simulation. The <span class="math notranslate nohighlight">\(i^{th}\)</span> snapshot is completed and saved <span class="math notranslate nohighlight">\(n_{z,{\rm snapshot}}=n_{\rm buffers}\cdot ({\rm buffer\ size})\)</span> time steps after it begins, which is when the effective snapshot length is covered by the simulation.</p></li>
</ul>
</section>
<section id="what-kinds-of-rz-output-do-you-support">
<h2>What kinds of RZ output do you support?<a class="headerlink" href="#what-kinds-of-rz-output-do-you-support" title="Link to this heading"></a></h2>
<p>In RZ, supported detail of RZ output depends on the <a class="reference internal" href="../dataanalysis/formats.html#dataanalysis-formats"><span class="std std-ref">output format</span></a> that is configured in the <a class="reference internal" href="parameters.html#running-cpp-parameters-diagnostics"><span class="std std-ref">inputs file</span></a>.</p>
<p>openPMD supports output of the detailed RZ modes and reconstructs representations on-the-fly in post-processing, e.g, in <code class="docutils literal notranslate"><span class="pre">openPMD-viewer</span></code> or other tools.
For some tools, this is in-development.</p>
<p>AMReX plotfiles and other in situ methods output a 2D reconstructed Cartesian slice at <span class="math notranslate nohighlight">\(\theta=0\)</span> by default (and can opt-in to dump raw modes).</p>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2024, MicroEleX collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>