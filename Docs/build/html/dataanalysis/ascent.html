<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>In situ Visualization with Ascent &mdash; MicroEleX 1.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/design-tabs.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MicroEleX
          </a>
              <div class="version">
                1.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../install/artemis.html">ARTEMIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/eleqtroneX.html">ELEQTRONeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/ferrox.html">FerroX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/magnex.html">MagneX</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">USAGE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage/run_artemis.html">Run ARTEMIS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/run_eleqtronex.html">Run ELEQTRONeX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/run_ferrox.html">Run FerroX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/run_magnex.html">Run MagneX</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DATA ANALYSIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="formats.html">Output Formats and Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="yt.html">yt-project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">EPILOGUE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Funding and Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MicroEleX</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">In situ Visualization with Ascent</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/dataanalysis/ascent.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="in-situ-visualization-with-ascent">
<span id="visualization-ascent"></span><h1>In situ Visualization with Ascent<a class="headerlink" href="#in-situ-visualization-with-ascent" title="Permalink to this heading"></a></h1>
<p>Ascent is a system designed to meet the in-situ visualization and analysis needs of simulation code teams running multi-physics calculations on many-core HPC architectures.
It provides rendering runtimes that can leverage many-core CPUs and GPUs to render images of simulation meshes.</p>
<section id="compiling-with-gnu-make">
<h2>Compiling with GNU Make<a class="headerlink" href="#compiling-with-gnu-make" title="Permalink to this heading"></a></h2>
<p>After building and installing Ascent according to the instructions at <a class="reference external" href="https://ascent.readthedocs.io/en/latest/BuildingAscent.html">Building Ascent</a>, you can enable support for it in WarpX by changing the line</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">USE_ASCENT_INSITU</span><span class="o">=</span>FALSE
</pre></div>
</div>
<p>in <code class="docutils literal notranslate"><span class="pre">GNUmakefile</span></code> to</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">USE_ASCENT_INSITU</span><span class="o">=</span>TRUE
</pre></div>
</div>
<p>Furthermore, you must ensure that either the <code class="code docutils literal notranslate"><span class="pre">ASCENT_DIR</span></code> shell environment variable contains the directory where Ascent is installed or you must specify this location when invoking make, i.e.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>make<span class="w"> </span>-j<span class="w"> </span><span class="m">8</span><span class="w"> </span><span class="nv">USE_ASCENT_INSITU</span><span class="o">=</span>TRUE<span class="w"> </span><span class="nv">ASCENT_DIR</span><span class="o">=</span>/path/to/ascent/install
</pre></div>
</div>
</section>
<section id="inputs-file-configuration">
<h2>Inputs File Configuration<a class="headerlink" href="#inputs-file-configuration" title="Permalink to this heading"></a></h2>
<p>Once WarpX has been compiled with Ascent support, it will need to be enabled and configured at runtime.
This is done using our usual inputs file (read with <code class="docutils literal notranslate"><span class="pre">amrex::ParmParse</span></code>).
The supported parameters are part of the <a class="reference internal" href="../usage/parameters.html#running-cpp-parameters-diagnostics"><span class="std std-ref">FullDiagnostics</span></a> with <code class="docutils literal notranslate"><span class="pre">&lt;diag_name&gt;.format</span></code> parameter set to <code class="docutils literal notranslate"><span class="pre">ascent</span></code>.</p>
</section>
<section id="visualization-analysis-pipeline-configuration">
<h2>Visualization/Analysis Pipeline Configuration<a class="headerlink" href="#visualization-analysis-pipeline-configuration" title="Permalink to this heading"></a></h2>
<p>Ascent uses the file <code class="code docutils literal notranslate"><span class="pre">ascent_actions.yaml</span></code> to configure analysis and visualization pipelines.
Ascent looks for the <code class="code docutils literal notranslate"><span class="pre">ascent_actions.yaml</span></code> file in the current working directory.</p>
<p>For example, the following <code class="code docutils literal notranslate"><span class="pre">ascent_actions.yaml</span></code> file extracts an isosurface of the field <code class="docutils literal notranslate"><span class="pre">Ex</span></code> for <code class="docutils literal notranslate"><span class="pre">15</span></code> levels and saves the resulting images to <code class="code docutils literal notranslate"><span class="pre">levels_&lt;nnnn&gt;.png</span></code>.
<a class="reference external" href="https://ascent.readthedocs.io/en/latest/Actions/index.html">Ascent Actions</a> provides an overview over all available analysis and visualization actions.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_pipelines&quot;</span>
<span class="w">  </span><span class="nt">pipelines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">p1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">f1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;contour&quot;</span>
<span class="w">        </span><span class="nt">params</span><span class="p">:</span>
<span class="w">           </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ex&quot;</span>
<span class="w">           </span><span class="nt">levels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">15</span>
<span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_scenes&quot;</span>
<span class="w">  </span><span class="nt">scenes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scene1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">image_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;levels_%04d&quot;</span>
<span class="w">      </span><span class="nt">plots</span><span class="p">:</span>
<span class="w">        </span><span class="nt">plot1</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pseudocolor&quot;</span>
<span class="w">          </span><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;p1&quot;</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ex&quot;</span>
</pre></div>
</div>
<p>Here is another <code class="code docutils literal notranslate"><span class="pre">ascent_actions.yaml</span></code> example that renders isosurfaces and particles:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_pipelines&quot;</span>
<span class="w">  </span><span class="nt">pipelines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">p1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">f1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;contour&quot;</span>
<span class="w">        </span><span class="nt">params</span><span class="p">:</span>
<span class="w">           </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bx&quot;</span>
<span class="w">           </span><span class="nt">levels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
<span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_scenes&quot;</span>
<span class="w">  </span><span class="nt">scenes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scene1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plots</span><span class="p">:</span>
<span class="w">        </span><span class="nt">plot1</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pseudocolor&quot;</span>
<span class="w">          </span><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;p1&quot;</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Bx&quot;</span>
<span class="w">        </span><span class="nt">plot2</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pseudocolor&quot;</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;particle_electrons_Bx&quot;</span>
<span class="w">          </span><span class="nt">points</span><span class="p">:</span>
<span class="w">            </span><span class="nt">radius</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0000005</span>
<span class="w">      </span><span class="nt">renders</span><span class="p">:</span>
<span class="w">        </span><span class="nt">r1</span><span class="p">:</span>
<span class="w">          </span><span class="nt">camera</span><span class="p">:</span>
<span class="w">            </span><span class="nt">azimuth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">            </span><span class="nt">elevation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">          </span><span class="nt">image_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;out_render_3d_%06d&quot;</span>
</pre></div>
</div>
<p>Finally, here is a more complex <code class="code docutils literal notranslate"><span class="pre">ascent_actions.yaml</span></code> example that creates the same images as the prior example, but adds a trigger that creates a Cinema Database at cycle <code class="docutils literal notranslate"><span class="pre">300</span></code>:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_triggers&quot;</span>
<span class="w">  </span><span class="nt">triggers</span><span class="p">:</span>
<span class="w">    </span><span class="nt">t1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">params</span><span class="p">:</span>
<span class="w">        </span><span class="nt">condition</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cycle()</span><span class="nv"> </span><span class="s">==</span><span class="nv"> </span><span class="s">300&quot;</span>
<span class="w">        </span><span class="nt">actions_file</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;trigger.yaml&quot;</span>
<span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_pipelines&quot;</span>
<span class="w">  </span><span class="nt">pipelines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">p1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">f1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;contour&quot;</span>
<span class="w">        </span><span class="nt">params</span><span class="p">:</span>
<span class="w">           </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;jy&quot;</span>
<span class="w">           </span><span class="nt">iso_values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">1000000000000.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">-1000000000000.0</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_scenes&quot;</span>
<span class="w">  </span><span class="nt">scenes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scene1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plots</span><span class="p">:</span>
<span class="w">        </span><span class="nt">plot1</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pseudocolor&quot;</span>
<span class="w">          </span><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;p1&quot;</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;jy&quot;</span>
<span class="w">        </span><span class="nt">plot2</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pseudocolor&quot;</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;particle_electrons_w&quot;</span>
<span class="w">          </span><span class="nt">points</span><span class="p">:</span>
<span class="w">            </span><span class="nt">radius</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0000002</span>
<span class="w">      </span><span class="nt">renders</span><span class="p">:</span>
<span class="w">        </span><span class="nt">r1</span><span class="p">:</span>
<span class="w">          </span><span class="nt">camera</span><span class="p">:</span>
<span class="w">            </span><span class="nt">azimuth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">100</span>
<span class="w">            </span><span class="nt">elevation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">          </span><span class="nt">image_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;out_render_jy_part_w_3d_%06d&quot;</span>
</pre></div>
</div>
<p>When the trigger condition is meet, <code class="docutils literal notranslate"><span class="pre">cycle()</span> <span class="pre">==</span> <span class="pre">300</span></code>, the actions in <code class="code docutils literal notranslate"><span class="pre">trigger.yaml</span></code> are also executed:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_pipelines&quot;</span>
<span class="w">  </span><span class="nt">pipelines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">p1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">f1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;contour&quot;</span>
<span class="w">        </span><span class="nt">params</span><span class="p">:</span>
<span class="w">           </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;jy&quot;</span>
<span class="w">           </span><span class="nt">iso_values</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">1000000000000.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">-1000000000000.0</span><span class="p p-Indicator">]</span>
<span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_scenes&quot;</span>
<span class="w">  </span><span class="nt">scenes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scene1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plots</span><span class="p">:</span>
<span class="w">        </span><span class="nt">plot1</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pseudocolor&quot;</span>
<span class="w">          </span><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;p1&quot;</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;jy&quot;</span>
<span class="w">        </span><span class="nt">plot2</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pseudocolor&quot;</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;particle_electrons_w&quot;</span>
<span class="w">          </span><span class="nt">points</span><span class="p">:</span>
<span class="w">            </span><span class="nt">radius</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0000001</span>
<span class="w">      </span><span class="nt">renders</span><span class="p">:</span>
<span class="w">        </span><span class="nt">r1</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cinema&quot;</span>
<span class="w">          </span><span class="nt">phi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">          </span><span class="nt">theta</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
<span class="w">          </span><span class="nt">db_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;cinema_out&quot;</span>
</pre></div>
</div>
<p>You can view the Cinema Database result by opening <code class="code docutils literal notranslate"><span class="pre">cinema_databases/cinema_out/index.html</span></code>.</p>
</section>
<section id="replay">
<h2>Replay<a class="headerlink" href="#replay" title="Permalink to this heading"></a></h2>
<p>With Ascent/Conduit, one can store the intermediate data files before the rendering step is applied to custom files.
These so-called <em>Conduit Blueprint HDF5</em> files can be “replayed”, i.e. rendered without running the simulation again.
VisIt 3.0+ also supports those files.</p>
<p><a class="reference external" href="https://ascent.readthedocs.io/en/latest/Utilities.html#getting-data-for-replay">Replay</a> is a utility that allows the user to replay a simulation from aforementioned files and rendering them with Ascent.
Replay enables the user or developer to pick specific time steps and load them for Ascent visualization, without running the simulation again.</p>
<p>We will guide you through the replay procedure.</p>
<section id="get-blueprint-files">
<h3>Get Blueprint Files<a class="headerlink" href="#get-blueprint-files" title="Permalink to this heading"></a></h3>
<p>To use replay, you first need <em>Conduit Blueprint HDF5</em> files.
The following block can be used in an ascent action to extract <em>Conduit Blueprint HDF5</em> files from a simulation run.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_extracts&quot;</span>
<span class="w">  </span><span class="nt">extracts</span><span class="p">:</span>
<span class="w">    </span><span class="nt">e1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;relay&quot;</span>
<span class="w">      </span><span class="nt">params</span><span class="p">:</span>
<span class="w">        </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;conduit_blueprint&quot;</span>
<span class="w">        </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;blueprint/mesh/hdf5&quot;</span>
</pre></div>
</div>
<p>The output in the WarpX run directory will look as in the following listing.
The <code class="docutils literal notranslate"><span class="pre">.root</span></code> file is a metadata file and the corresponding directory contains the conduit blueprint data in an internal format that is based on HDF5.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conduit_blueprint.cycle_000000/
conduit_blueprint.cycle_000000.root
conduit_blueprint.cycle_000050/
conduit_blueprint.cycle_000050.root
conduit_blueprint.cycle_000100/
conduit_blueprint.cycle_000100.root
</pre></div>
</div>
<p>In order to select a few time steps after the fact, a so-called <em>cycles file</em> can be created.
A cycles file is a simple text file that lists one root file per line, e.g.:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>conduit_blueprint.cycle_000100.root
conduit_blueprint.cycle_000050.root
</pre></div>
</div>
</section>
<section id="run-replay">
<h3>Run Replay<a class="headerlink" href="#run-replay" title="Permalink to this heading"></a></h3>
<p>For Ascent Replay, two command line tools are provided in the utilities/replay directory of the Ascent installation.
There are two version of replay: the MPI-parallel version <code class="docutils literal notranslate"><span class="pre">replay_mpi</span></code> and a serial version, <code class="docutils literal notranslate"><span class="pre">replay_ser</span></code>.
Use an MPI-parallel replay with data sets created with MPI-parallel builds of WarpX.
Here we use <code class="docutils literal notranslate"><span class="pre">replay_mpi</span></code> as an example.</p>
<p>The options for replay are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">--root</span></code>: specifies Blueprint root file to load</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--cycles</span></code>: specifies a text file containing a list of Blueprint root files to load</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">--actions</span></code>: specifies the name of the actions file to use (default: <code class="docutils literal notranslate"><span class="pre">ascent_actions.yaml</span></code>)</p></li>
</ul>
<p>Instead of starting a simulation that generates data for Ascent, we now execute <code class="docutils literal notranslate"><span class="pre">replay_ser</span></code>/<code class="docutils literal notranslate"><span class="pre">replay_mpi</span></code>.
Replay will loop over the files listed in <code class="docutils literal notranslate"><span class="pre">cycles</span></code> in the order in which they appear in the cycles file.</p>
<p>For example, for a small data example that fits on a single computer:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./replay_ser<span class="w"> </span>--root<span class="o">=</span>conduit_blueprint.cycle_000400.root<span class="w"> </span>--actions<span class="o">=</span>ascent_actions.yaml
</pre></div>
</div>
<p>Will replay the data of WarpX step 400 (“cycle” 400).
A whole set of steps can be replayed with the above mentioned <em>cycles file</em>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./replay_ser<span class="w"> </span>--cycles<span class="o">=</span>warpx_list.txt<span class="w"> </span>--actions<span class="o">=</span>ascent_actions.yaml
</pre></div>
</div>
<p>For larger examples, e.g. on a cluster with <em>Slurm</em> batch system, a parallel launch could look like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># one step</span>
srun<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="w"> </span>./replay_mpi<span class="w"> </span>--root<span class="o">=</span>conduit_blueprint.cycle_000400.root<span class="w"> </span>--actions<span class="o">=</span>ascent_actions.yaml
<span class="c1"># multiple steps</span>
srun<span class="w"> </span>-n<span class="w"> </span><span class="m">8</span><span class="w"> </span>./replay_mpi<span class="w"> </span>--cycles<span class="o">=</span>warpx_list.txt<span class="w"> </span>--actions<span class="o">=</span>ascent_actions.yaml
</pre></div>
</div>
</section>
<section id="example-actions">
<h3>Example Actions<a class="headerlink" href="#example-actions" title="Permalink to this heading"></a></h3>
<p>A visualization of the electric field component <span class="math notranslate nohighlight">\(E_x\)</span> (variable: <code class="docutils literal notranslate"><span class="pre">Ex</span></code>) with a contour plot and with added particles can be obtained with the following Ascent Action.
This action can be used both in replay as well as in situ runs.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_pipelines&quot;</span>
<span class="w">  </span><span class="nt">pipelines</span><span class="p">:</span>
<span class="w">    </span><span class="nt">clipped_volume</span><span class="p">:</span>
<span class="w">      </span><span class="nt">f0</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;contour&quot;</span>
<span class="w">        </span><span class="nt">params</span><span class="p">:</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ex&quot;</span>
<span class="w">          </span><span class="nt">levels</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">16</span>
<span class="w">      </span><span class="nt">f1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;clip&quot;</span>
<span class="w">        </span><span class="nt">params</span><span class="p">:</span>
<span class="w">          </span><span class="nt">topology</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">topo</span><span class="w"> </span><span class="c1"># name of the amr mesh</span>
<span class="w">          </span><span class="nt">multi_plane</span><span class="p">:</span>
<span class="w">            </span><span class="nt">point1</span><span class="p">:</span>
<span class="w">              </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">            </span><span class="nt">normal1</span><span class="p">:</span>
<span class="w">              </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1.0</span>
<span class="w">              </span><span class="nt">z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">            </span><span class="nt">point2</span><span class="p">:</span>
<span class="w">              </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">            </span><span class="nt">normal2</span><span class="p">:</span>
<span class="w">              </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-0.7</span>
<span class="w">              </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-0.7</span>
<span class="w">              </span><span class="nt">z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">    </span><span class="nt">sampled_particles</span><span class="p">:</span>
<span class="w">      </span><span class="nt">f1</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">histsampling</span>
<span class="w">        </span><span class="nt">params</span><span class="p">:</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">particle_electrons_uz</span>
<span class="w">          </span><span class="nt">bins</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">64</span>
<span class="w">          </span><span class="nt">sample_rate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.90</span>
<span class="w">      </span><span class="nt">f2</span><span class="p">:</span>
<span class="w">        </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;clip&quot;</span>
<span class="w">        </span><span class="nt">params</span><span class="p">:</span>
<span class="w">          </span><span class="nt">topology</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">particle_electrons</span><span class="w"> </span><span class="c1"># particle data</span>
<span class="w">          </span><span class="nt">multi_plane</span><span class="p">:</span>
<span class="w">            </span><span class="nt">point1</span><span class="p">:</span>
<span class="w">              </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">            </span><span class="nt">normal1</span><span class="p">:</span>
<span class="w">              </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-1.0</span>
<span class="w">              </span><span class="nt">z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">            </span><span class="nt">point2</span><span class="p">:</span>
<span class="w">              </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">              </span><span class="nt">z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>
<span class="w">            </span><span class="nt">normal2</span><span class="p">:</span>
<span class="w">              </span><span class="nt">x</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-0.7</span>
<span class="w">              </span><span class="nt">y</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-0.7</span>
<span class="w">              </span><span class="nt">z</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0.0</span>

<span class="c1"># Uncomment this block if you want to create &quot;Conduit Blueprint files&quot; that can</span>
<span class="c1"># be used with Ascent &quot;replay&quot; after the simulation run.</span>
<span class="c1"># Replay is a workflow to visualize individual steps without running the simulation again.</span>
<span class="c1">#-</span>
<span class="c1">#  action: &quot;add_extracts&quot;</span>
<span class="c1">#  extracts:</span>
<span class="c1">#    e1:</span>
<span class="c1">#      type: &quot;relay&quot;</span>
<span class="c1">#      params:</span>
<span class="c1">#        path: &quot;./conduit_blueprint&quot;</span>
<span class="c1">#        protocol: &quot;blueprint/mesh/hdf5&quot;</span>

<span class="p p-Indicator">-</span>
<span class="w">  </span><span class="nt">action</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;add_scenes&quot;</span>
<span class="w">  </span><span class="nt">scenes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">scene1</span><span class="p">:</span>
<span class="w">      </span><span class="nt">plots</span><span class="p">:</span>
<span class="w">        </span><span class="nt">p0</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pseudocolor&quot;</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;particle_electrons_uz&quot;</span>
<span class="w">          </span><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sampled_particles&quot;</span>
<span class="w">        </span><span class="nt">p1</span><span class="p">:</span>
<span class="w">          </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;pseudocolor&quot;</span>
<span class="w">          </span><span class="nt">field</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Ex&quot;</span>
<span class="w">          </span><span class="nt">pipeline</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;clipped_volume&quot;</span>
<span class="w">      </span><span class="nt">renders</span><span class="p">:</span>
<span class="w">        </span><span class="nt">image1</span><span class="p">:</span>
<span class="w">          </span><span class="nt">bg_color</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">1.0</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">fg_color</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0.0</span><span class="p p-Indicator">]</span>
<span class="w">          </span><span class="nt">image_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;lwfa_Ex_e-uz_%06d&quot;</span>
<span class="w">          </span><span class="nt">camera</span><span class="p">:</span>
<span class="w">            </span><span class="nt">azimuth</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span>
<span class="w">            </span><span class="nt">elevation</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
<span class="w">            </span><span class="nt">zoom</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2.5</span>
</pre></div>
</div>
<p>There are more <a class="reference external" href="https://ascent.readthedocs.io/en/latest/Actions/Examples.html#yaml-examples">Ascent Actions examples available</a> for you to play.</p>
</section>
<section id="workflow">
<h3>Workflow<a class="headerlink" href="#workflow" title="Permalink to this heading"></a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This section is in-progress.
TODOs: finalize acceptance testing; update 3D LWFA example</p>
</div>
<p>In the preparation of simulations, it is generally useful to run small, under-resolved versions of the planned simulation layout first.
Ascent replay is helpful in the setup of an in situ visualization pipeline during this process.
In the following, a Jupyter-based workflow is shown that can be used to quickly iterate on the design of a <code class="docutils literal notranslate"><span class="pre">ascent_actions.yaml</span></code> file, repeatedly rendering the same (small) data.</p>
<p>First, run a small simulation, e.g. on a local computer, and create conduit blueprint files (see above).
Second, copy the Jupyter Notebook file <code class="xref download docutils literal notranslate"><span class="pre">ascent_replay_warpx.ipynb</span></code> into the simulation output directory.
Third, download and start a Docker container with a prepared Jupyter installation and Ascent Python bindings from the simulation output directory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker<span class="w"> </span>pull<span class="w"> </span>alpinedav/ascent-jupyter:latest
docker<span class="w"> </span>run<span class="w"> </span>-v<span class="nv">$PWD</span>:/home/user/ascent/install-debug/examples/ascent/tutorial/ascent_intro/notebooks/replay<span class="w"> </span>-p<span class="w"> </span><span class="m">8000</span>:8000<span class="w"> </span>-p<span class="w"> </span><span class="m">8888</span>:8888<span class="w"> </span>-p<span class="w"> </span><span class="m">9000</span>:9000<span class="w"> </span>-p<span class="w"> </span><span class="m">10000</span>:10000<span class="w"> </span>-t<span class="w"> </span>-i<span class="w"> </span>alpinedav/ascent-jupyter:latest
</pre></div>
</div>
<p>Now, access Jupyter Lab via: <a class="reference external" href="http://localhost:8888/lab">http://localhost:8888/lab</a> (password: <code class="docutils literal notranslate"><span class="pre">learn</span></code>).</p>
<p>Inside the Jupyter Lab is a <code class="docutils literal notranslate"><span class="pre">replay/</span></code> directory, which mounts the outer working directory.
You can now open <code class="docutils literal notranslate"><span class="pre">ascent_replay_warpx.ipynb</span></code> and execute all cells.
The last two cells are the replay action that can be quickly iterated: change <code class="docutils literal notranslate"><span class="pre">replay_actions.yaml</span></code> cell and execute both.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>Keep an eye on the terminal, if a replay action is erroneous it will show up on the terminal that started the docker container.
(TODO: We might want to catch that inside python and print it in Jupyter instead.)</p></li>
<li><p>If you remove a “key” from the replay action, you might see an error in the <code class="docutils literal notranslate"><span class="pre">AscentViewer</span></code>.
Restart and execute all cells in that case.</p></li>
</ul>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2024, MicroEleX collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>