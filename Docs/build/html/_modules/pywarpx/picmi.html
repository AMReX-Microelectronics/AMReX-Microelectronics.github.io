<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pywarpx.picmi &mdash; ARTEMIS 23.04 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=eb127c28"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/design-tabs.js?v=36754332"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            ARTEMIS
          </a>
              <div class="version">
                23.04
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../coc.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledge_us.html">Acknowledge WarpX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../highlights.html">Science Highlights</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">INSTALLATION</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../install/users.html">Users</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/cmake.html">Developers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install/hpc.html">HPC</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">USAGE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../usage/how_to_run.html">Run WarpX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/domain_decomposition.html">Domain Decomposition</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/parameters.html">Input Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/python.html">Python (PICMI)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/pwfa.html">In-Depth: PWFA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../usage/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DATA ANALYSIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/formats.html">Output formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/yt.html">yt-project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/openpmdviewer.html">openPMD-viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/openpmdapi.html">openPMD-api</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/paraview.html">3D Visualization: ParaView</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/visit.html">3D Visualization: VisIt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/visualpic.html">VisualPIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/picviewer.html">PICViewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/reduced_diags.html">Reduced diagnostics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataanalysis/workflows.html">Workflows</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">THEORY</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../theory/intro.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory/picsar_theory.html">Particle-in-Cell Method</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory/picsar_theory.html#filtering">Filtering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory/amr.html">Mesh refinement</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory/PML.html">Boundary conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory/boosted_frame.html">Moving window and optimal Lorentz boosted frame</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory/input_output.html">Inputs and Outputs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory/collisions.html">Collisions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">DEVELOPMENT</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../developers/contributing.html">Contribute to WarpX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/workflows.html">Workflows</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/developers.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/doxygen.html">C++ Objects &amp; Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/gnumake.html">GNUmake Build System (Legacy)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers/faq.html">FAQ</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MAINTENANCE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../maintenance/release.html">Dependencies &amp; Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../maintenance/performance_tests.html">Automated performance tests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">EPILOGUE</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../acknowledgements.html">Funding and Acknowledgements</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">ARTEMIS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pywarpx.picmi</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pywarpx.picmi</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright 2018-2022 Andrew Myers, David Grote, Ligia Diana Amorim</span>
<span class="c1"># Maxence Thevenet, Remi Lehe, Revathi Jambunathan, Lorenzo Giacomel</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># This file is part of WarpX.</span>
<span class="c1">#</span>
<span class="c1"># License: BSD-3-Clause-LBNL</span>

<span class="sd">&quot;&quot;&quot;Classes following the PICMI standard</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">periodictable</span>

<span class="kn">import</span> <span class="nn">picmistandard</span>
<span class="kn">import</span> <span class="nn">pywarpx</span>

<span class="n">codename</span> <span class="o">=</span> <span class="s1">&#39;warpx&#39;</span>
<span class="n">picmistandard</span><span class="o">.</span><span class="n">register_codename</span><span class="p">(</span><span class="n">codename</span><span class="p">)</span>

<span class="c1"># dictionary to map field boundary conditions from picmistandard to WarpX</span>
<span class="n">BC_map</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;open&#39;</span><span class="p">:</span><span class="s1">&#39;pml&#39;</span><span class="p">,</span> <span class="s1">&#39;dirichlet&#39;</span><span class="p">:</span><span class="s1">&#39;pec&#39;</span><span class="p">,</span> <span class="s1">&#39;periodic&#39;</span><span class="p">:</span><span class="s1">&#39;periodic&#39;</span><span class="p">,</span> <span class="s1">&#39;damped&#39;</span><span class="p">:</span><span class="s1">&#39;damped&#39;</span><span class="p">,</span>
    <span class="s1">&#39;absorbing_silver_mueller&#39;</span><span class="p">:</span><span class="s1">&#39;absorbing_silver_mueller&#39;</span><span class="p">,</span>
    <span class="s1">&#39;neumann&#39;</span><span class="p">:</span><span class="s1">&#39;neumann&#39;</span><span class="p">,</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">:</span><span class="s1">&#39;none&#39;</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">constants</span><span class="p">:</span>
    <span class="c1"># --- Put the constants in their own namespace</span>
    <span class="c1"># --- Values from WarpXConst.H</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mf">299792458.</span>
    <span class="n">ep0</span> <span class="o">=</span> <span class="mf">8.8541878128e-12</span>
    <span class="n">mu0</span> <span class="o">=</span> <span class="mf">1.25663706212e-06</span>
    <span class="n">q_e</span> <span class="o">=</span> <span class="mf">1.602176634e-19</span>
    <span class="n">m_e</span> <span class="o">=</span> <span class="mf">9.1093837015e-31</span>
    <span class="n">m_p</span> <span class="o">=</span> <span class="mf">1.67262192369e-27</span>
    <span class="n">hbar</span> <span class="o">=</span> <span class="mf">1.054571817e-34</span>
    <span class="n">kb</span> <span class="o">=</span> <span class="mf">1.380649e-23</span>

<span class="n">picmistandard</span><span class="o">.</span><span class="n">register_constants</span><span class="p">(</span><span class="n">constants</span><span class="p">)</span>


<div class="viewcode-block" id="Species"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.Species">[docs]</a><span class="k">class</span> <span class="nc">Species</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_Species</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    warpx_boost_adjust_transverse_positions: bool, default=False</span>
<span class="sd">        Whether to adjust transverse positions when apply the boost</span>
<span class="sd">        to the simulation frame</span>

<span class="sd">    warpx_self_fields_required_precision: float, default=1.e-11</span>
<span class="sd">        Relative precision on the electrostatic solver</span>
<span class="sd">        (when using the relativistic solver)</span>

<span class="sd">    warpx_self_fields_absolute_tolerance: float, default=0.</span>
<span class="sd">        Absolute precision on the electrostatic solver</span>
<span class="sd">        (when using the relativistic solver)</span>

<span class="sd">    warpx_self_fields_max_iters: integer, default=200</span>
<span class="sd">        Maximum number of iterations for the electrostatic</span>
<span class="sd">        solver for the species</span>

<span class="sd">    warpx_self_fields_verbosity: integer, default=2</span>
<span class="sd">        Level of verbosity for the electrostatic solver</span>

<span class="sd">    warpx_save_previous_position: bool, default=False</span>
<span class="sd">        Whether to save the old particle positions</span>

<span class="sd">    warpx_do_not_deposit: bool, default=False</span>
<span class="sd">        Whether or not to deposit the charge and current density for</span>
<span class="sd">        for this species</span>

<span class="sd">    warpx_do_not_push: bool, default=False</span>
<span class="sd">        Whether or not to push this species</span>

<span class="sd">    warpx_do_not_gather: bool, default=False</span>
<span class="sd">        Whether or not to gahter the fields from grids for this species</span>

<span class="sd">    warpx_random_theta: bool, default=True</span>
<span class="sd">        Whether or not to add random angle to the particles in theta</span>
<span class="sd">        when in RZ mode.</span>

<span class="sd">    warpx_reflection_model_xlo: string, default=&#39;0.&#39;</span>
<span class="sd">        Expression (in terms of the velocity &quot;v&quot;) specifying the probability</span>
<span class="sd">        that the particle will reflect on the lower x boundary</span>

<span class="sd">    warpx_reflection_model_xhi: string, default=&#39;0.&#39;</span>
<span class="sd">        Expression (in terms of the velocity &quot;v&quot;) specifying the probability</span>
<span class="sd">        that the particle will reflect on the upper x boundary</span>

<span class="sd">    warpx_reflection_model_ylo: string, default=&#39;0.&#39;</span>
<span class="sd">        Expression (in terms of the velocity &quot;v&quot;) specifying the probability</span>
<span class="sd">        that the particle will reflect on the lower y boundary</span>

<span class="sd">    warpx_reflection_model_yhi: string, default=&#39;0.&#39;</span>
<span class="sd">        Expression (in terms of the velocity &quot;v&quot;) specifying the probability</span>
<span class="sd">        that the particle will reflect on the upper y boundary</span>

<span class="sd">    warpx_reflection_model_zlo: string, default=&#39;0.&#39;</span>
<span class="sd">        Expression (in terms of the velocity &quot;v&quot;) specifying the probability</span>
<span class="sd">        that the particle will reflect on the lower z boundary</span>

<span class="sd">    warpx_reflection_model_zhi: string, default=&#39;0.&#39;</span>
<span class="sd">        Expression (in terms of the velocity &quot;v&quot;) specifying the probability</span>
<span class="sd">        that the particle will reflect on the upper z boundary</span>

<span class="sd">    warpx_save_particles_at_xlo: bool, default=False</span>
<span class="sd">        Whether to save particles lost at the lower x boundary</span>

<span class="sd">    warpx_save_particles_at_xhi: bool, default=False</span>
<span class="sd">        Whether to save particles lost at the upper x boundary</span>

<span class="sd">    warpx_save_particles_at_ylo: bool, default=False</span>
<span class="sd">        Whether to save particles lost at the lower y boundary</span>

<span class="sd">    warpx_save_particles_at_yhi: bool, default=False</span>
<span class="sd">        Whether to save particles lost at the upper y boundary</span>

<span class="sd">    warpx_save_particles_at_zlo: bool, default=False</span>
<span class="sd">        Whether to save particles lost at the lower z boundary</span>

<span class="sd">    warpx_save_particles_at_zhi: bool, default=False</span>
<span class="sd">        Whether to save particles lost at the upper z boundary</span>

<span class="sd">    warpx_save_particles_at_eb: bool, default=False</span>
<span class="sd">        Whether to save particles lost at the embedded boundary</span>

<span class="sd">    warpx_do_resampling: bool, default=False</span>
<span class="sd">        Whether particles will be resampled</span>

<span class="sd">    warpx_resampling_trigger_intervals: bool, default=0</span>
<span class="sd">        Timesteps at which to resample</span>

<span class="sd">    warpx_resampling_trigger_max_avg_ppc: int, default=infinity</span>
<span class="sd">        Resampling will be done when the average number of</span>
<span class="sd">        particles per cell exceeds this number</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_type</span> <span class="o">==</span> <span class="s1">&#39;electron&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="s1">&#39;-q_e&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="s1">&#39;m_e&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_type</span> <span class="o">==</span> <span class="s1">&#39;positron&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="s1">&#39;q_e&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="s1">&#39;m_e&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_type</span> <span class="o">==</span> <span class="s1">&#39;proton&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="s1">&#39;q_e&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="s1">&#39;m_p&#39;</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_type</span> <span class="o">==</span> <span class="s1">&#39;anti-proton&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="s1">&#39;-q_e&#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="s1">&#39;m_p&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_state</span> <span class="o">==</span> <span class="o">+</span><span class="mf">1.</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="s1">&#39;q_e&#39;</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_state</span> <span class="o">==</span> <span class="o">-</span><span class="mf">1.</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="s1">&#39;-q_e&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_state</span><span class="o">*</span><span class="n">constants</span><span class="o">.</span><span class="n">q_e</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Match a string of the format &#39;#nXx&#39;, with the &#39;#n&#39; optional isotope number.</span>
                <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?P&lt;iso&gt;#[\d+])*(?P&lt;sym&gt;[A-Za-z]+)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_type</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">element</span> <span class="o">=</span> <span class="n">periodictable</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">symbol</span><span class="p">(</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;sym&#39;</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">m</span><span class="p">[</span><span class="s1">&#39;iso&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">element</span> <span class="o">=</span> <span class="n">element</span><span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s1">&#39;iso&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">:]]</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_state</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_state</span> <span class="o">&lt;=</span> <span class="n">element</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> charge state not valid&#39;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">particle_type</span><span class="p">)</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="n">element</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">ion</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">charge_state</span><span class="p">]</span>
                        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                            <span class="c1"># Note that not all valid charge states are defined in elements,</span>
                            <span class="c1"># so this value error can be ignored.</span>
                            <span class="k">pass</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">element</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">mass</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">mass</span><span class="o">*</span><span class="n">periodictable</span><span class="o">.</span><span class="n">constants</span><span class="o">.</span><span class="n">atomic_mass_constant</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The species &quot;particle_type&quot; is not known&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">boost_adjust_transverse_positions</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_boost_adjust_transverse_positions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># For the relativistic electrostatic solver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_required_precision</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_self_fields_required_precision&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_absolute_tolerance</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_self_fields_absolute_tolerance&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_max_iters</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_self_fields_max_iters&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_verbosity</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_self_fields_verbosity&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_previous_position</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_save_previous_position&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_not_deposit</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_not_deposit&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_not_push</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_not_push&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_not_gather</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_not_gather&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_theta</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_random_theta&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># For particle reflection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_xlo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_reflection_model_xlo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_xhi</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_reflection_model_xhi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_ylo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_reflection_model_ylo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_yhi</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_reflection_model_yhi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_zlo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_reflection_model_zlo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_zhi</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_reflection_model_zhi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># self.reflection_model_eb = kw.pop(&#39;warpx_reflection_model_eb&#39;, None)</span>

        <span class="c1"># For the scraper buffer</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_xlo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_save_particles_at_xlo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_xhi</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_save_particles_at_xhi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_ylo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_save_particles_at_ylo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_yhi</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_save_particles_at_yhi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_zlo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_save_particles_at_zlo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_zhi</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_save_particles_at_zhi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_eb</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_save_particles_at_eb&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Resampling settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_resampling</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_resampling&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resampling_trigger_intervals</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_resampling_trigger_intervals&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resampling_triggering_max_avg_ppc</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_resampling_trigger_max_avg_ppc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span>
                          <span class="n">initialize_self_fields</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">injection_plane_position</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">injection_plane_normal_vector</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">species_names</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;species</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_number</span><span class="p">)</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">species_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">initialize_self_fields</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initialize_self_fields</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">Bucket</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                             <span class="n">mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mass</span><span class="p">,</span>
                                             <span class="n">charge</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
                                             <span class="n">injection_style</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                             <span class="n">initialize_self_fields</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">initialize_self_fields</span><span class="p">),</span>
                                             <span class="n">boost_adjust_transverse_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boost_adjust_transverse_positions</span><span class="p">,</span>
                                             <span class="n">self_fields_required_precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_required_precision</span><span class="p">,</span>
                                             <span class="n">self_fields_absolute_tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_absolute_tolerance</span><span class="p">,</span>
                                             <span class="n">self_fields_max_iters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_max_iters</span><span class="p">,</span>
                                             <span class="n">self_fields_verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_verbosity</span><span class="p">,</span>
                                             <span class="n">save_particles_at_xlo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_xlo</span><span class="p">,</span>
                                             <span class="n">save_particles_at_xhi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_xhi</span><span class="p">,</span>
                                             <span class="n">save_particles_at_ylo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_ylo</span><span class="p">,</span>
                                             <span class="n">save_particles_at_yhi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_yhi</span><span class="p">,</span>
                                             <span class="n">save_particles_at_zlo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_zlo</span><span class="p">,</span>
                                             <span class="n">save_particles_at_zhi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_zhi</span><span class="p">,</span>
                                             <span class="n">save_particles_at_eb</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_particles_at_eb</span><span class="p">,</span>
                                             <span class="n">save_previous_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_previous_position</span><span class="p">,</span>
                                             <span class="n">do_not_deposit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_not_deposit</span><span class="p">,</span>
                                             <span class="n">do_not_push</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_not_push</span><span class="p">,</span>
                                             <span class="n">do_not_gather</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_not_gather</span><span class="p">,</span>
                                             <span class="n">random_theta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_theta</span><span class="p">,</span>
                                             <span class="n">do_resampling</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">do_resampling</span><span class="p">,</span>
                                             <span class="n">resampling_trigger_intervals</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resampling_trigger_intervals</span><span class="p">,</span>
                                             <span class="n">resampling_trigger_max_avg_ppc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resampling_triggering_max_avg_ppc</span><span class="p">)</span>

        <span class="c1"># add reflection models</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">add_new_attr</span><span class="p">(</span><span class="s2">&quot;reflection_model_xlo(E)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_xlo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">add_new_attr</span><span class="p">(</span><span class="s2">&quot;reflection_model_xhi(E)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_xhi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">add_new_attr</span><span class="p">(</span><span class="s2">&quot;reflection_model_ylo(E)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_ylo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">add_new_attr</span><span class="p">(</span><span class="s2">&quot;reflection_model_yhi(E)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_yhi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">add_new_attr</span><span class="p">(</span><span class="s2">&quot;reflection_model_zlo(E)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_zlo</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">add_new_attr</span><span class="p">(</span><span class="s2">&quot;reflection_model_zhi(E)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflection_model_zhi</span><span class="p">)</span>
        <span class="c1"># self.species.add_new_attr(&quot;reflection_model_eb(E)&quot;, self.reflection_model_eb)</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">Particles</span><span class="o">.</span><span class="n">particles_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">initial_distribution</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">initial_distribution</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species_number</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">density_scale</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">injection_plane_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">injection_plane_normal_vector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">injection_plane_normal_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.</span> <span class="ow">and</span> <span class="n">injection_plane_normal_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">,</span>\
                    <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Rigid injection can only be done along z&#39;</span><span class="p">)</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">rigid_injected_species</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">rigid_advance</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">zinject_plane</span> <span class="o">=</span> <span class="n">injection_plane_position</span></div>


<span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_MultiSpecies</span><span class="o">.</span><span class="n">Species_class</span> <span class="o">=</span> <span class="n">Species</span>
<div class="viewcode-block" id="MultiSpecies"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.MultiSpecies">[docs]</a><span class="k">class</span> <span class="nc">MultiSpecies</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_MultiSpecies</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span>
                          <span class="n">initialize_self_fields</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                          <span class="n">injection_plane_position</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                          <span class="n">injection_plane_normal_vector</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species_instances_list</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span>
                                      <span class="n">initialize_self_fields</span><span class="p">,</span>
                                      <span class="n">injection_plane_position</span><span class="p">,</span>
                                      <span class="n">injection_plane_normal_vector</span><span class="p">)</span></div>


<div class="viewcode-block" id="GaussianBunchDistribution"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.GaussianBunchDistribution">[docs]</a><span class="k">class</span> <span class="nc">GaussianBunchDistribution</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_GaussianBunchDistribution</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_symmetrize</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_symmetrize&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">symmetrization_order</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_symmetrization_order&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species_number</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">density_scale</span><span class="p">):</span>
        <span class="n">species</span><span class="o">.</span><span class="n">injection_style</span> <span class="o">=</span> <span class="s2">&quot;gaussian_beam&quot;</span>
        <span class="n">species</span><span class="o">.</span><span class="n">x_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">y_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">z_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">x_rms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_bunch_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">y_rms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_bunch_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">z_rms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_bunch_size</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="c1"># --- Only PseudoRandomLayout is supported</span>
        <span class="n">species</span><span class="o">.</span><span class="n">npart</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">n_macroparticles</span>

        <span class="c1"># --- Calculate the total charge. Note that charge might be a string instead of a number.</span>
        <span class="n">charge</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">charge</span>
        <span class="k">if</span> <span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;q_e&#39;</span> <span class="ow">or</span> <span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;+q_e&#39;</span><span class="p">:</span>
            <span class="n">charge</span> <span class="o">=</span> <span class="n">constants</span><span class="o">.</span><span class="n">q_e</span>
        <span class="k">elif</span> <span class="n">charge</span> <span class="o">==</span> <span class="s1">&#39;-q_e&#39;</span><span class="p">:</span>
            <span class="n">charge</span> <span class="o">=</span> <span class="o">-</span><span class="n">constants</span><span class="o">.</span><span class="n">q_e</span>
        <span class="n">species</span><span class="o">.</span><span class="n">q_tot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_physical_particles</span><span class="o">*</span><span class="n">charge</span>
        <span class="k">if</span> <span class="n">density_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">q_tot</span> <span class="o">*=</span> <span class="n">density_scale</span>

        <span class="c1"># --- The PICMI standard doesn&#39;t yet have a way of specifying these values.</span>
        <span class="c1"># --- They should default to the size of the domain. They are not typically</span>
        <span class="c1"># --- necessary though since any particles outside the domain are rejected.</span>
        <span class="c1">#species.xmin</span>
        <span class="c1">#species.xmax</span>
        <span class="c1">#species.ymin</span>
        <span class="c1">#species.ymax</span>
        <span class="c1">#species.zmin</span>
        <span class="c1">#species.zmax</span>

        <span class="c1"># --- Note that WarpX takes gamma*beta as input</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">velocity_divergence</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
            <span class="n">species</span><span class="o">.</span><span class="n">momentum_distribution_type</span> <span class="o">=</span> <span class="s2">&quot;radial_expansion&quot;</span>
            <span class="n">species</span><span class="o">.</span><span class="n">u_over_r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">velocity_divergence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="c1">#species.u_over_y = self.velocity_divergence[1]/constants.c</span>
            <span class="c1">#species.u_over_z = self.velocity_divergence[2]/constants.c</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_velocity</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
            <span class="n">species</span><span class="o">.</span><span class="n">momentum_distribution_type</span> <span class="o">=</span> <span class="s2">&quot;gaussian&quot;</span>
            <span class="n">species</span><span class="o">.</span><span class="n">ux_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uy_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uz_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_velocity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">ux_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uy_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uz_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_velocity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">momentum_distribution_type</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span>
            <span class="n">species</span><span class="o">.</span><span class="n">ux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">centroid_velocity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>

        <span class="n">species</span><span class="o">.</span><span class="n">do_symmetrize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_symmetrize</span>
        <span class="n">species</span><span class="o">.</span><span class="n">symmetrization_order</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetrization_order</span></div>


<span class="k">class</span> <span class="nc">DensityDistributionBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This is a base class for several predefined density distributions. It</span>
<span class="sd">    captures universal initialization logic.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">set_mangle_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;mangle_dict&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;user_defined_kw&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Only do this once so that the same variables can be used multiple</span>
            <span class="c1"># times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">add_keywords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_species_attributes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">layout</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">GriddedLayout</span><span class="p">):</span>
            <span class="c1"># --- Note that the grid attribute of GriddedLayout is ignored</span>
            <span class="n">species</span><span class="o">.</span><span class="n">injection_style</span> <span class="o">=</span> <span class="s2">&quot;nuniformpercell&quot;</span>
            <span class="n">species</span><span class="o">.</span><span class="n">num_particles_per_cell_each_dim</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">n_macroparticle_per_cell</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">PseudoRandomLayout</span><span class="p">):</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">layout</span><span class="o">.</span><span class="n">n_macroparticles_per_cell</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">),</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WarpX only supports n_macroparticles_per_cell for the PseudoRandomLayout with this distribution&#39;</span><span class="p">)</span>
            <span class="n">species</span><span class="o">.</span><span class="n">injection_style</span> <span class="o">=</span> <span class="s2">&quot;nrandompercell&quot;</span>
            <span class="n">species</span><span class="o">.</span><span class="n">num_particles_per_cell</span> <span class="o">=</span> <span class="n">layout</span><span class="o">.</span><span class="n">n_macroparticles_per_cell</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WarpX does not support the specified layout for this distribution&#39;</span><span class="p">)</span>

        <span class="n">species</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">zmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">species</span><span class="o">.</span><span class="n">zmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_in</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">do_continuous_injection</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c1"># --- Note that WarpX takes gamma*beta as input</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;momentum_expressions&quot;</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">momentum_expressions</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
        <span class="p">):</span>
            <span class="n">species</span><span class="o">.</span><span class="n">momentum_distribution_type</span> <span class="o">=</span> <span class="s1">&#39;parse_momentum_function&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_parse_momentum_functions</span><span class="p">(</span><span class="n">species</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rms_velocity</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
            <span class="n">species</span><span class="o">.</span><span class="n">momentum_distribution_type</span> <span class="o">=</span> <span class="s2">&quot;gaussian&quot;</span>
            <span class="n">species</span><span class="o">.</span><span class="n">ux_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uy_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uz_m</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_velocity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">ux_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uy_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uz_th</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rms_velocity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">momentum_distribution_type</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span>
            <span class="n">species</span><span class="o">.</span><span class="n">ux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
            <span class="n">species</span><span class="o">.</span><span class="n">uz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">directed_velocity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>

    <span class="k">def</span> <span class="nf">setup_parse_momentum_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sdir</span><span class="p">,</span> <span class="n">idir</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">momentum_expressions</span><span class="p">[</span><span class="n">idir</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">momentum_expressions</span><span class="p">[</span><span class="n">idir</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">directed_velocity</span><span class="p">[</span><span class="n">idir</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="n">species</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;momentum_function_u</span><span class="si">{</span><span class="n">sdir</span><span class="si">}</span><span class="s1">(x,y,z)&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;(</span><span class="si">{</span><span class="n">expression</span><span class="si">}</span><span class="s1">)/</span><span class="si">{</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">UniformFluxDistribution</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_UniformFluxDistribution</span><span class="p">,</span> <span class="n">DensityDistributionBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species_number</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">density_scale</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fill_in</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_mangle_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_species_attributes</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">layout</span><span class="p">)</span>

        <span class="n">species</span><span class="o">.</span><span class="n">flux_profile</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span>
        <span class="n">species</span><span class="o">.</span><span class="n">flux</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux</span>
        <span class="k">if</span> <span class="n">density_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">flux</span> <span class="o">*=</span> <span class="n">density_scale</span>
        <span class="n">species</span><span class="o">.</span><span class="n">flux_normal_axis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_normal_axis</span>
        <span class="n">species</span><span class="o">.</span><span class="n">surface_flux_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">surface_flux_position</span>
        <span class="n">species</span><span class="o">.</span><span class="n">flux_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_direction</span>
        <span class="n">species</span><span class="o">.</span><span class="n">flux_tmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_tmin</span>
        <span class="n">species</span><span class="o">.</span><span class="n">flux_tmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">flux_tmax</span>

        <span class="c1"># --- Use specific attributes for flux injection</span>
        <span class="n">species</span><span class="o">.</span><span class="n">injection_style</span> <span class="o">=</span> <span class="s2">&quot;nfluxpercell&quot;</span>
        <span class="k">assert</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">layout</span><span class="p">,</span> <span class="n">PseudoRandomLayout</span><span class="p">)),</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;UniformFluxDistribution only supports the PseudoRandomLayout in WarpX&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gaussian_flux_momentum_distribution</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">momentum_distribution_type</span> <span class="o">=</span> <span class="s2">&quot;gaussianflux&quot;</span>


<div class="viewcode-block" id="UniformDistribution"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.UniformDistribution">[docs]</a><span class="k">class</span> <span class="nc">UniformDistribution</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_UniformDistribution</span><span class="p">,</span> <span class="n">DensityDistributionBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species_number</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">density_scale</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_mangle_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_species_attributes</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">layout</span><span class="p">)</span>

        <span class="c1"># --- Only constant density is supported by this class</span>
        <span class="n">species</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="s2">&quot;constant&quot;</span>
        <span class="n">species</span><span class="o">.</span><span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">density</span>
        <span class="k">if</span> <span class="n">density_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">density</span> <span class="o">*=</span> <span class="n">density_scale</span></div>


<div class="viewcode-block" id="AnalyticDistribution"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.AnalyticDistribution">[docs]</a><span class="k">class</span> <span class="nc">AnalyticDistribution</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_AnalyticDistribution</span><span class="p">,</span> <span class="n">DensityDistributionBase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species_number</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">density_scale</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_mangle_dict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_species_attributes</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">layout</span><span class="p">)</span>

        <span class="n">species</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="s2">&quot;parse_density_function&quot;</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">density_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">density_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;density_function(x,y,z)&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;density_function(x,y,z)&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">*(</span><span class="si">{}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">density_scale</span><span class="p">,</span> <span class="n">expression</span><span class="p">))</span></div>


<div class="viewcode-block" id="ParticleListDistribution"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.ParticleListDistribution">[docs]</a><span class="k">class</span> <span class="nc">ParticleListDistribution</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_ParticleListDistribution</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">species_number</span><span class="p">,</span> <span class="n">layout</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">density_scale</span><span class="p">):</span>

        <span class="n">species</span><span class="o">.</span><span class="n">injection_style</span> <span class="o">=</span> <span class="s2">&quot;multipleparticles&quot;</span>
        <span class="n">species</span><span class="o">.</span><span class="n">multiple_particles_pos_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">x</span>
        <span class="n">species</span><span class="o">.</span><span class="n">multiple_particles_pos_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span>
        <span class="n">species</span><span class="o">.</span><span class="n">multiple_particles_pos_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">z</span>
        <span class="n">species</span><span class="o">.</span><span class="n">multiple_particles_ux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ux</span><span class="p">)</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
        <span class="n">species</span><span class="o">.</span><span class="n">multiple_particles_uy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uy</span><span class="p">)</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
        <span class="n">species</span><span class="o">.</span><span class="n">multiple_particles_uz</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">uz</span><span class="p">)</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>
        <span class="n">species</span><span class="o">.</span><span class="n">multiple_particles_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span>
        <span class="k">if</span> <span class="n">density_scale</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">species</span><span class="o">.</span><span class="n">multiple_particles_weight</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">weight</span><span class="o">*</span><span class="n">density_scale</span></div>


<span class="k">class</span> <span class="nc">ParticleDistributionPlanarInjector</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_ParticleDistributionPlanarInjector</span><span class="p">):</span>
    <span class="k">pass</span>


<div class="viewcode-block" id="GriddedLayout"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.GriddedLayout">[docs]</a><span class="k">class</span> <span class="nc">GriddedLayout</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_GriddedLayout</span><span class="p">):</span>
    <span class="k">pass</span></div>


<div class="viewcode-block" id="PseudoRandomLayout"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.PseudoRandomLayout">[docs]</a><span class="k">class</span> <span class="nc">PseudoRandomLayout</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_PseudoRandomLayout</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Warning: WarpX does not support specifying the random number seed in PseudoRandomLayout&#39;</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">BinomialSmoother</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_BinomialSmoother</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">use_filter</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">use_filter_compensation</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compensation</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pass</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If not specified, do at least one pass in each direction.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_pass</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Check if n_pass is a vector</span>
            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_pass</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="c1"># If not, make it a vector</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">n_pass</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">number_of_dimensions</span><span class="o">*</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">n_pass</span><span class="p">]</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">filter_npass_each_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_pass</span>


<div class="viewcode-block" id="CylindricalGrid"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.CylindricalGrid">[docs]</a><span class="k">class</span> <span class="nc">CylindricalGrid</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_CylindricalGrid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This assumes that WarpX was compiled with USE_RZ = TRUE</span>

<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">    warpx_max_grid_size: integer, default=32</span>
<span class="sd">       Maximum block size in either direction</span>

<span class="sd">    warpx_max_grid_size_x: integer, optional</span>
<span class="sd">       Maximum block size in radial direction</span>

<span class="sd">    warpx_max_grid_size_y: integer, optional</span>
<span class="sd">       Maximum block size in longitudinal direction</span>

<span class="sd">    warpx_blocking_factor: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size)</span>

<span class="sd">    warpx_blocking_factor_x: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size) in the radial direction</span>

<span class="sd">    warpx_blocking_factor_y: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size) in the longitudinal direction</span>

<span class="sd">    warpx_potential_lo_r: float, default=0.</span>
<span class="sd">       Electrostatic potential on the lower radial boundary</span>

<span class="sd">    warpx_potential_hi_r: float, default=0.</span>
<span class="sd">       Electrostatic potential on the upper radial boundary</span>

<span class="sd">    warpx_potential_lo_z: float, default=0.</span>
<span class="sd">       Electrostatic potential on the lower longitudinal boundary</span>

<span class="sd">    warpx_potential_hi_z: float, default=0.</span>
<span class="sd">       Electrostatic potential on the upper longitudinal boundary</span>

<span class="sd">    warpx_reflect_all_velocities: bool default=False</span>
<span class="sd">        Whether the sign of all of the particle velocities are changed upon</span>
<span class="sd">        reflection on a boundary, or only the velocity normal to the surface</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size_y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor_y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potential_xmin</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_lo_r&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_xmax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_hi_r&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_ymin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_ymax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_zmin</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_lo_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_zmax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_hi_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reflect_all_velocities</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_reflect_all_velocities&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Geometry</span>
        <span class="c1"># Set these as soon as the information is available</span>
        <span class="c1"># (since these are needed to determine which shared object to load)</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="s1">&#39;RZ&#39;</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">prob_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span>  <span class="c1"># physical domain</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">prob_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">n_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_cells</span>

        <span class="c1"># Maximum allowable size of each subdomain in the problem domain;</span>
        <span class="c1">#    this is used to decompose the domain for parallel calculations.</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_x</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_y</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_x</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_y</span>

        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Lower radial boundary must be &gt;= 0.&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_boundary_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;periodic&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_boundary_conditions</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;periodic&#39;</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Radial boundaries can not be periodic&#39;</span><span class="p">)</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">n_rz_azimuthal_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_azimuthal_modes</span>

        <span class="c1"># Boundary conditions</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">field_lo</span> <span class="o">=</span> <span class="p">[</span><span class="n">BC_map</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_boundary_conditions</span><span class="p">]</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">field_hi</span> <span class="o">=</span> <span class="p">[</span><span class="n">BC_map</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_boundary_conditions</span><span class="p">]</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">particle_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_boundary_conditions_particles</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">particle_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_boundary_conditions_particles</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">reflect_all_velocities</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">reflect_all_velocities</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_moving_window</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_dir</span> <span class="o">=</span> <span class="s1">&#39;r&#39;</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>  <span class="c1"># in units of the speed of light</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_dir</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>  <span class="c1"># in units of the speed of light</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WarpX only supports one refined region.&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The one refined region can only be level 1&#39;</span><span class="p">)</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">fine_tag_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">fine_tag_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># The refinement_factor is ignored (assumed to be [2,2])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Cartesian1DGrid"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.Cartesian1DGrid">[docs]</a><span class="k">class</span> <span class="nc">Cartesian1DGrid</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_Cartesian1DGrid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">    warpx_max_grid_size: integer, default=32</span>
<span class="sd">       Maximum block size in either direction</span>

<span class="sd">    warpx_max_grid_size_x: integer, optional</span>
<span class="sd">       Maximum block size in longitudinal direction</span>

<span class="sd">    warpx_blocking_factor: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size)</span>

<span class="sd">    warpx_blocking_factor_x: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size) in the longitudinal direction</span>

<span class="sd">    warpx_potential_lo_z: float, default=0.</span>
<span class="sd">       Electrostatic potential on the lower longitudinal boundary</span>

<span class="sd">    warpx_potential_hi_z: float, default=0.</span>
<span class="sd">       Electrostatic potential on the upper longitudinal boundary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potential_xmin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_xmax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_ymin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_ymax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_zmin</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_lo_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_zmax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_hi_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Geometry</span>
        <span class="c1"># Set these as soon as the information is available</span>
        <span class="c1"># (since these are needed to determine which shared object to load)</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="s1">&#39;1&#39;</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">prob_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span>  <span class="c1"># physical domain</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">prob_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">n_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_cells</span>

        <span class="c1"># Maximum allowable size of each subdomain in the problem domain;</span>
        <span class="c1">#    this is used to decompose the domain for parallel calculations.</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_x</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_x</span>

        <span class="c1"># Boundary conditions</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">field_lo</span> <span class="o">=</span> <span class="p">[</span><span class="n">BC_map</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_boundary_conditions</span><span class="p">]</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">field_hi</span> <span class="o">=</span> <span class="p">[</span><span class="n">BC_map</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_boundary_conditions</span><span class="p">]</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">particle_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_boundary_conditions_particles</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">particle_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_boundary_conditions_particles</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_moving_window</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_dir</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>  <span class="c1"># in units of the speed of light</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WarpX only supports one refined region.&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The one refined region can only be level 1&#39;</span><span class="p">)</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">fine_tag_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">fine_tag_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># The refinement_factor is ignored (assumed to be [2,2])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">0</span></div>

<div class="viewcode-block" id="Cartesian2DGrid"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.Cartesian2DGrid">[docs]</a><span class="k">class</span> <span class="nc">Cartesian2DGrid</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_Cartesian2DGrid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">    warpx_max_grid_size: integer, default=32</span>
<span class="sd">       Maximum block size in either direction</span>

<span class="sd">    warpx_max_grid_size_x: integer, optional</span>
<span class="sd">       Maximum block size in x direction</span>

<span class="sd">    warpx_max_grid_size_y: integer, optional</span>
<span class="sd">       Maximum block size in z direction</span>

<span class="sd">    warpx_blocking_factor: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size)</span>

<span class="sd">    warpx_blocking_factor_x: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size) in the x direction</span>

<span class="sd">    warpx_blocking_factor_y: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size) in the z direction</span>

<span class="sd">    warpx_potential_lo_x: float, default=0.</span>
<span class="sd">       Electrostatic potential on the lower x boundary</span>

<span class="sd">    warpx_potential_hi_x: float, default=0.</span>
<span class="sd">       Electrostatic potential on the upper x boundary</span>

<span class="sd">    warpx_potential_lo_z: float, default=0.</span>
<span class="sd">       Electrostatic potential on the lower z boundary</span>

<span class="sd">    warpx_potential_hi_z: float, default=0.</span>
<span class="sd">       Electrostatic potential on the upper z boundary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size_y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor_y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potential_xmin</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_lo_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_xmax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_hi_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_ymin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_ymax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_zmin</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_lo_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_zmax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_hi_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Geometry</span>
        <span class="c1"># Set these as soon as the information is available</span>
        <span class="c1"># (since these are needed to determine which shared object to load)</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="s1">&#39;2&#39;</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">prob_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span>  <span class="c1"># physical domain</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">prob_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">n_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_cells</span>

        <span class="c1"># Maximum allowable size of each subdomain in the problem domain;</span>
        <span class="c1">#    this is used to decompose the domain for parallel calculations.</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_x</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_y</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_x</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_y</span>

        <span class="c1"># Boundary conditions</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">field_lo</span> <span class="o">=</span> <span class="p">[</span><span class="n">BC_map</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_boundary_conditions</span><span class="p">]</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">field_hi</span> <span class="o">=</span> <span class="p">[</span><span class="n">BC_map</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_boundary_conditions</span><span class="p">]</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">particle_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_boundary_conditions_particles</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">particle_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_boundary_conditions_particles</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_moving_window</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_dir</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>  <span class="c1"># in units of the speed of light</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_dir</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>  <span class="c1"># in units of the speed of light</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WarpX only supports one refined region.&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The one refined region can only be level 1&#39;</span><span class="p">)</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">fine_tag_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">fine_tag_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># The refinement_factor is ignored (assumed to be [2,2])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="Cartesian3DGrid"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.Cartesian3DGrid">[docs]</a><span class="k">class</span> <span class="nc">Cartesian3DGrid</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_Cartesian3DGrid</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ---------</span>
<span class="sd">    warpx_max_grid_size: integer, default=32</span>
<span class="sd">       Maximum block size in either direction</span>

<span class="sd">    warpx_max_grid_size_x: integer, optional</span>
<span class="sd">       Maximum block size in x direction</span>

<span class="sd">    warpx_max_grid_size_y: integer, optional</span>
<span class="sd">       Maximum block size in z direction</span>

<span class="sd">    warpx_max_grid_size_z: integer, optional</span>
<span class="sd">       Maximum block size in z direction</span>

<span class="sd">    warpx_blocking_factor: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size)</span>

<span class="sd">    warpx_blocking_factor_x: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size) in the x direction</span>

<span class="sd">    warpx_blocking_factor_y: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size) in the z direction</span>

<span class="sd">    warpx_blocking_factor_z: integer, optional</span>
<span class="sd">       Blocking factor (which controls the block size) in the z direction</span>

<span class="sd">    warpx_potential_lo_x: float, default=0.</span>
<span class="sd">       Electrostatic potential on the lower x boundary</span>

<span class="sd">    warpx_potential_hi_x: float, default=0.</span>
<span class="sd">       Electrostatic potential on the upper x boundary</span>

<span class="sd">    warpx_potential_lo_y: float, default=0.</span>
<span class="sd">       Electrostatic potential on the lower z boundary</span>

<span class="sd">    warpx_potential_hi_y: float, default=0.</span>
<span class="sd">       Electrostatic potential on the upper z boundary</span>

<span class="sd">    warpx_potential_lo_z: float, default=0.</span>
<span class="sd">       Electrostatic potential on the lower z boundary</span>

<span class="sd">    warpx_potential_hi_z: float, default=0.</span>
<span class="sd">       Electrostatic potential on the upper z boundary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size&#39;</span><span class="p">,</span> <span class="mi">32</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size_y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_z</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_max_grid_size_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor_y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_z</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_blocking_factor_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potential_xmin</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_lo_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_xmax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_hi_x&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_ymin</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_lo_y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_ymax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_hi_y&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_zmin</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_lo_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potential_zmax</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_potential_hi_z&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Geometry</span>
        <span class="c1"># Set these as soon as the information is available</span>
        <span class="c1"># (since these are needed to determine which shared object to load)</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dims</span> <span class="o">=</span> <span class="s1">&#39;3&#39;</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">prob_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span>  <span class="c1"># physical domain</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">prob_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">n_cell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_cells</span>

        <span class="c1"># Maximum allowable size of each subdomain in the problem domain;</span>
        <span class="c1">#    this is used to decompose the domain for parallel calculations.</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_x</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_y</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_grid_size_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_grid_size_z</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_x</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_y</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">blocking_factor_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocking_factor_z</span>

        <span class="c1"># Boundary conditions</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">field_lo</span> <span class="o">=</span> <span class="p">[</span><span class="n">BC_map</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_boundary_conditions</span><span class="p">]</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">field_hi</span> <span class="o">=</span> <span class="p">[</span><span class="n">BC_map</span><span class="p">[</span><span class="n">bc</span><span class="p">]</span> <span class="k">for</span> <span class="n">bc</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_boundary_conditions</span><span class="p">]</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">particle_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_boundary_conditions_particles</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">particle_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_boundary_conditions_particles</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">not_equal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_moving_window</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_dir</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>  <span class="c1"># in units of the speed of light</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_dir</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>  <span class="c1"># in units of the speed of light</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_dir</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">moving_window_v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">moving_window_velocity</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>  <span class="c1"># in units of the speed of light</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WarpX only supports one refined region.&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The one refined region can only be level 1&#39;</span><span class="p">)</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">fine_tag_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">fine_tag_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">refined_regions</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="c1"># The refinement_factor is ignored (assumed to be [2,2,2])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">max_level</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="ElectromagneticSolver"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.ElectromagneticSolver">[docs]</a><span class="k">class</span> <span class="nc">ElectromagneticSolver</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_ElectromagneticSolver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    warpx_pml_ncell: integer, optional</span>
<span class="sd">        The depth of the PML, in number of cells</span>

<span class="sd">    warpx_periodic_single_box_fft: bool, default=False</span>
<span class="sd">        Whether to do the spectral solver FFTs assuming a single</span>
<span class="sd">        simulation block</span>

<span class="sd">    warpx_current_correction: bool, default=True</span>
<span class="sd">        Whether to do the current correction for the spectral solver.</span>
<span class="sd">        See documentation for exceptions to the default value.</span>

<span class="sd">    warpx_psatd_update_with_rho: bool, optional</span>
<span class="sd">        Whether to update with the actual rho for the spectral solver</span>

<span class="sd">    warpx_psatd_do_time_averaging: bool, optional</span>
<span class="sd">        Whether to do the time averaging for the spectral solver</span>

<span class="sd">    warpx_psatd_J_in_time: {&#39;constant&#39;, &#39;linear&#39;}, default=&#39;constant&#39;</span>
<span class="sd">        This determines whether the current density is assumed to be constant</span>
<span class="sd">        or linear in time, within the time step over which the electromagnetic</span>
<span class="sd">        fields are evolved.</span>

<span class="sd">    warpx_psatd_rho_in_time: {&#39;linear&#39;}, default=&#39;linear&#39;</span>
<span class="sd">        This determines whether the charge density is assumed to be linear</span>
<span class="sd">        in time, within the time step over which the electromagnetic fields are evolved.</span>

<span class="sd">    warpx_do_pml_in_domain: bool, default=False</span>
<span class="sd">        Whether to do the PML boundaries within the domain (versus</span>
<span class="sd">        in the guard cells)</span>

<span class="sd">    warpx_pml_has_particles: bool, default=False</span>
<span class="sd">        Whether to allow particles in the PML region</span>

<span class="sd">    warpx_do_pml_j_damping: bool, default=False</span>
<span class="sd">        Whether to do damping of J in the PML</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Yee&#39;</span><span class="p">,</span> <span class="s1">&#39;CKC&#39;</span><span class="p">,</span> <span class="s1">&#39;PSATD&#39;</span><span class="p">,</span> <span class="s1">&#39;ECT&#39;</span><span class="p">],</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Only &#39;Yee&#39;, &#39;CKC&#39;, &#39;PSATD&#39;, and &#39;ECT&#39; are supported&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pml_ncell</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_pml_ncell&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;PSATD&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psatd_periodic_single_box_fft</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_periodic_single_box_fft&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psatd_current_correction</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_current_correction&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psatd_update_with_rho</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_psatd_update_with_rho&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psatd_do_time_averaging</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_psatd_do_time_averaging&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psatd_J_in_time</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_psatd_J_in_time&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">psatd_rho_in_time</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_psatd_rho_in_time&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">do_pml_in_domain</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_pml_in_domain&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pml_has_particles</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_pml_has_particles&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_pml_j_damping</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_pml_j_damping&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">pml_ncell</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pml_ncell</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;PSATD&#39;</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">periodic_single_box_fft</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psatd_periodic_single_box_fft</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">current_correction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psatd_current_correction</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">update_with_rho</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psatd_update_with_rho</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">do_time_averaging</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psatd_do_time_averaging</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">J_in_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psatd_J_in_time</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">rho_in_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">psatd_rho_in_time</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">guard_cells</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">nx_guard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">guard_cells</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">number_of_dimensions</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">ny_guard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">guard_cells</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">nz_guard</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">guard_cells</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stencil_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">nox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stencil_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">number_of_dimensions</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stencil_order</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">noz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stencil_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">galilean_velocity</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">number_of_dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">galilean_velocity</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">galilean_velocity</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">galilean_velocity</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">psatd</span><span class="o">.</span><span class="n">v_galilean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">galilean_velocity</span><span class="p">)</span><span class="o">/</span><span class="n">constants</span><span class="o">.</span><span class="n">c</span>

        <span class="c1"># --- Same method names are used, though mapped to lower case.</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">maxwell_solver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfl</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">cfl</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cfl</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_smoother</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">source_smoother</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_dive_cleaning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">divE_cleaning</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_divb_cleaning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">divB_cleaning</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_pml_dive_cleaning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pml_divE_cleaning</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_pml_divb_cleaning</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pml_divB_cleaning</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_pml_in_domain</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_pml_in_domain</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">pml_has_particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pml_has_particles</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_pml_j_damping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_pml_j_damping</span></div>


<span class="k">class</span> <span class="nc">HybridPICSolver</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_ClassWithInit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Hybrid-PIC solver based on Ohm&#39;s law.</span>
<span class="sd">    See `Theory Section &lt;https://warpx.readthedocs.io/en/latest/theory/kinetic_fluid_hybrid_model.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    Te: float</span>
<span class="sd">        Electron temperature in eV.</span>

<span class="sd">    n0: float</span>
<span class="sd">        Reference plasma density in m^-3.</span>

<span class="sd">    gamma: float, default=3/2</span>
<span class="sd">        Exponent in calculation of electron pressure.</span>

<span class="sd">    n_floor: float, optional</span>
<span class="sd">        Minimum density used in Ohm&#39;s law calculation.</span>

<span class="sd">    plasma_resistivity: float or str</span>
<span class="sd">        Value or expression to use for the plasma resistivity.</span>

<span class="sd">    substeps: int, default=100</span>
<span class="sd">        Number of substeps to take when updating the B-field.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">Te</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n0</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">n_floor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plasma_resistivity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">substeps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="s2">&quot;hybrid&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">Te</span> <span class="o">=</span> <span class="n">Te</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n0</span> <span class="o">=</span> <span class="n">n0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_floor</span> <span class="o">=</span> <span class="n">n_floor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plasma_resistivity</span> <span class="o">=</span> <span class="n">plasma_resistivity</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">substeps</span> <span class="o">=</span> <span class="n">substeps</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle_init</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">maxwell_solver</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">method</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">hybridpicmodel</span><span class="o">.</span><span class="n">elec_temp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Te</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">hybridpicmodel</span><span class="o">.</span><span class="n">n0_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n0</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">hybridpicmodel</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">hybridpicmodel</span><span class="o">.</span><span class="n">n_floor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_floor</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">hybridpicmodel</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span>
            <span class="s1">&#39;plasma_resistivity(rho)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plasma_resistivity</span>
        <span class="p">)</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">hybridpicmodel</span><span class="o">.</span><span class="n">substeps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">substeps</span>


<div class="viewcode-block" id="ElectrostaticSolver"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.ElectrostaticSolver">[docs]</a><span class="k">class</span> <span class="nc">ElectrostaticSolver</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_ElectrostaticSolver</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    warpx_relativistic: bool, default=False</span>
<span class="sd">        Whether to use the relativistic solver or lab frame solver</span>

<span class="sd">    warpx_absolute_tolerance: float, default=0.</span>
<span class="sd">        Absolute tolerance on the lab fram solver</span>

<span class="sd">    warpx_self_fields_verbosity: integer, default=2</span>
<span class="sd">        Level of verbosity for the lab frame solver</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">relativistic</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_relativistic&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">absolute_tolerance</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_absolute_tolerance&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_verbosity</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_self_fields_verbosity&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">magnetostatic</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_magnetostatic&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">relativistic</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_electrostatic</span> <span class="o">=</span> <span class="s1">&#39;relativistic&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">magnetostatic</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_electrostatic</span> <span class="o">=</span> <span class="s1">&#39;labframe-electromagnetostatic&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_electrostatic</span> <span class="o">=</span> <span class="s1">&#39;labframe&#39;</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">self_fields_required_precision</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_precision</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">self_fields_absolute_tolerance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">absolute_tolerance</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">self_fields_max_iters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maximum_iterations</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">self_fields_verbosity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">self_fields_verbosity</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">potential_lo_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">potential_xmin</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">potential_lo_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">potential_ymin</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">potential_lo_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">potential_zmin</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">potential_hi_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">potential_xmax</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">potential_hi_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">potential_ymax</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">boundary</span><span class="o">.</span><span class="n">potential_hi_z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">potential_zmax</span></div>


<div class="viewcode-block" id="GaussianLaser"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.GaussianLaser">[docs]</a><span class="k">class</span> <span class="nc">GaussianLaser</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_GaussianLaser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pywarpx</span><span class="o">.</span><span class="n">lasers</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;laser</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">laser_number</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">Lasers</span><span class="o">.</span><span class="n">newlaser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="s2">&quot;Gaussian&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span>  <span class="c1"># The wavelength of the laser (in meters)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">e_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">E0</span>  <span class="c1"># Maximum amplitude of the laser field (in V/m)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_direction</span>  <span class="c1"># The main polarization vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">profile_waist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">waist</span>  <span class="c1"># The waist of the laser (in meters)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">profile_duration</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">duration</span>  <span class="c1"># The duration of the laser (in seconds)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagation_direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">zeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">beta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">beta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">phi2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">phi0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">do_continuous_injection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_in</span></div>

<div class="viewcode-block" id="AnalyticLaser"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.AnalyticLaser">[docs]</a><span class="k">class</span> <span class="nc">AnalyticLaser</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_AnalyticLaser</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser_number</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pywarpx</span><span class="o">.</span><span class="n">lasers</span><span class="o">.</span><span class="n">names</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;laser</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">laser_number</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">Lasers</span><span class="o">.</span><span class="n">newlaser</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">profile</span> <span class="o">=</span> <span class="s2">&quot;parse_field_function&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">wavelength</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wavelength</span>  <span class="c1"># The wavelength of the laser (in meters)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">e_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Emax</span>  <span class="c1"># Maximum amplitude of the laser field (in V/m)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">polarization</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">polarization_direction</span>  <span class="c1"># The main polarization vector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">propagation_direction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">do_continuous_injection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fill_in</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Only do this once so that the same variables are used in this distribution</span>
            <span class="c1"># is used multiple times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">add_keywords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">)</span>
        <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">field_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;field_function(X,Y,t)&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span></div>


<div class="viewcode-block" id="LaserAntenna"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.LaserAntenna">[docs]</a><span class="k">class</span> <span class="nc">LaserAntenna</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_LaserAntenna</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">laser</span><span class="p">):</span>
        <span class="n">laser</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span>  <span class="c1"># This point is on the laser plane</span>
        <span class="k">if</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">normal_vector</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">laser</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">direction</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normal_vector</span><span class="p">)</span>
        <span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
                <span class="s1">&#39;The specified laser direction does not match the &#39;</span>
                <span class="s1">&#39;specified antenna normal.&#39;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normal_vector</span> <span class="o">=</span> <span class="n">laser</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">direction</span> <span class="c1"># The plane normal direction</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">laser</span><span class="p">,</span> <span class="n">GaussianLaser</span><span class="p">):</span>
            <span class="c1"># Focal distance from the antenna (in meters)</span>
            <span class="n">laser</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">profile_focal_distance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="n">laser</span><span class="o">.</span><span class="n">focal_position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">laser</span><span class="o">.</span><span class="n">focal_position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                <span class="p">(</span><span class="n">laser</span><span class="o">.</span><span class="n">focal_position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="p">)</span>
            <span class="c1"># The time at which the laser reaches its peak (in seconds)</span>
            <span class="n">laser</span><span class="o">.</span><span class="n">laser</span><span class="o">.</span><span class="n">profile_t_peak</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">laser</span><span class="o">.</span><span class="n">centroid_position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">laser</span><span class="o">.</span><span class="n">centroid_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">laser</span><span class="o">.</span><span class="n">centroid_position</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span>
            <span class="p">)</span> <span class="o">/</span> <span class="n">constants</span><span class="o">.</span><span class="n">c</span></div>


<span class="k">class</span> <span class="nc">LoadInitialField</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_LoadGriddedField</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">read_fields_from_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">read_fields_from_path</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_E</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">E_ext_grid_init_style</span> <span class="o">=</span> <span class="s1">&#39;read_from_file&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_B</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">B_ext_grid_init_style</span> <span class="o">=</span> <span class="s1">&#39;read_from_file&#39;</span>


<span class="k">class</span> <span class="nc">AnalyticInitialField</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_AnalyticAppliedField</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Note that lower and upper_bound are not used by WarpX</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Only do this once so that the same variables are used in this distribution</span>
            <span class="c1"># is used multiple times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">add_keywords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ex_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ey_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ez_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">E_ext_grid_init_style</span> <span class="o">=</span> <span class="s1">&#39;parse_e_ext_grid_function&#39;</span>
            <span class="k">for</span> <span class="n">sdir</span><span class="p">,</span> <span class="n">expression</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Ex_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ey_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ez_expression</span><span class="p">]):</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;E</span><span class="si">{</span><span class="n">sdir</span><span class="si">}</span><span class="s1">_external_grid_function(x,y,z)&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bx_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">By_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bz_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">B_ext_grid_init_style</span> <span class="o">=</span> <span class="s1">&#39;parse_b_ext_grid_function&#39;</span>
            <span class="k">for</span> <span class="n">sdir</span><span class="p">,</span> <span class="n">expression</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Bx_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">By_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bz_expression</span><span class="p">]):</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;B</span><span class="si">{</span><span class="n">sdir</span><span class="si">}</span><span class="s1">_external_grid_function(x,y,z)&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span>


<div class="viewcode-block" id="ConstantAppliedField"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.ConstantAppliedField">[docs]</a><span class="k">class</span> <span class="nc">ConstantAppliedField</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_ConstantAppliedField</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Note that lower and upper_bound are not used by WarpX</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ex</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ey</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ez</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">E_ext_particle_init_style</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">E_external_particle</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Ex</span> <span class="ow">or</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ey</span> <span class="ow">or</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ez</span> <span class="ow">or</span> <span class="mf">0.</span><span class="p">]</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">By</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bz</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">B_ext_particle_init_style</span> <span class="o">=</span> <span class="s1">&#39;constant&#39;</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">B_external_particle</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Bx</span> <span class="ow">or</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">By</span> <span class="ow">or</span> <span class="mf">0.</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bz</span> <span class="ow">or</span> <span class="mf">0.</span><span class="p">]</span></div>


<div class="viewcode-block" id="AnalyticAppliedField"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.AnalyticAppliedField">[docs]</a><span class="k">class</span> <span class="nc">AnalyticAppliedField</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_AnalyticAppliedField</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Note that lower and upper_bound are not used by WarpX</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Only do this once so that the same variables are used in this distribution</span>
            <span class="c1"># is used multiple times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">add_keywords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Ex_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ey_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Ez_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">E_ext_particle_init_style</span> <span class="o">=</span> <span class="s1">&#39;parse_e_ext_particle_function&#39;</span>
            <span class="k">for</span> <span class="n">sdir</span><span class="p">,</span> <span class="n">expression</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Ex_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ey_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Ez_expression</span><span class="p">]):</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;E</span><span class="si">{</span><span class="n">sdir</span><span class="si">}</span><span class="s1">_external_particle_function(x,y,z,t)&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Bx_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">By_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Bz_expression</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">B_ext_particle_init_style</span> <span class="o">=</span> <span class="s1">&#39;parse_b_ext_particle_function&#39;</span>
            <span class="k">for</span> <span class="n">sdir</span><span class="p">,</span> <span class="n">expression</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">],</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Bx_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">By_expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Bz_expression</span><span class="p">]):</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="n">expression</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;B</span><span class="si">{</span><span class="n">sdir</span><span class="si">}</span><span class="s1">_external_particle_function(x,y,z,t)&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span></div>


<div class="viewcode-block" id="Mirror"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.Mirror">[docs]</a><span class="k">class</span> <span class="nc">Mirror</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_Mirror</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">num_mirrors</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">num_mirrors</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">mirror_z</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">mirror_z_width</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">mirror_z_npoints</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">num_mirrors</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">mirror_z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">z_front_location</span><span class="p">)</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">mirror_z_width</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">depth</span><span class="p">)</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">mirror_z_npoints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">FieldIonization</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_FieldIonization</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    WarpX only has ADK ionization model implemented.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">==</span> <span class="s1">&#39;ADK&#39;</span><span class="p">,</span> <span class="s1">&#39;WarpX only has ADK ionization model implemented&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionized_species</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">do_field_ionization</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionized_species</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">physical_element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionized_species</span><span class="o">.</span><span class="n">particle_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionized_species</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">ionization_product_species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">product_species</span><span class="o">.</span><span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionized_species</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">ionization_initial_level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ionized_species</span><span class="o">.</span><span class="n">charge_state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ionized_species</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="s1">&#39;q_e&#39;</span>


<div class="viewcode-block" id="CoulombCollisions"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.CoulombCollisions">[docs]</a><span class="k">class</span> <span class="nc">CoulombCollisions</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_ClassWithInit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom class to handle setup of binary Coulmb collisions in WarpX. If</span>
<span class="sd">    collision initialization is added to picmistandard this can be changed to</span>
<span class="sd">    inherit that functionality.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: string</span>
<span class="sd">        Name of instance (used in the inputs file)</span>

<span class="sd">    species: list of species instances</span>
<span class="sd">        The species involved in the collision. Must be of length 2.</span>

<span class="sd">    CoulombLog: float, optional</span>
<span class="sd">        Value of the Coulomb log to use in the collision cross section.</span>
<span class="sd">        If not supplied, it is calculated from the local conditions.</span>

<span class="sd">    ndt: integer, optional</span>
<span class="sd">        The collisions will be applied every &quot;ndt&quot; steps. Must be 1 or larger.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">CoulombLog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CoulombLog</span> <span class="o">=</span> <span class="n">CoulombLog</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndt</span> <span class="o">=</span> <span class="n">ndt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle_init</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">collision</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">Collisions</span><span class="o">.</span><span class="n">newcollision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">collision</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;pairwisecoulomb&#39;</span>
        <span class="n">collision</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="n">species</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">species</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">]</span>
        <span class="n">collision</span><span class="o">.</span><span class="n">CoulombLog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">CoulombLog</span>
        <span class="n">collision</span><span class="o">.</span><span class="n">ndt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndt</span></div>


<div class="viewcode-block" id="MCCCollisions"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.MCCCollisions">[docs]</a><span class="k">class</span> <span class="nc">MCCCollisions</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_ClassWithInit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom class to handle setup of MCC collisions in WarpX. If collision</span>
<span class="sd">    initialization is added to picmistandard this can be changed to inherit</span>
<span class="sd">    that functionality.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: string</span>
<span class="sd">        Name of instance (used in the inputs file)</span>

<span class="sd">    species: species instance</span>
<span class="sd">        The species involved in the collision</span>

<span class="sd">    background_density: float or string</span>
<span class="sd">        The density of the background. An string expression as a function of (x, y, z, t) can be used.</span>

<span class="sd">    background_temperature: float or string</span>
<span class="sd">        The temperature of the background. An string expression as a function of (x, y, z, t) can be used.</span>

<span class="sd">    scattering_processes: dictionary</span>
<span class="sd">        The scattering process to use and any needed information</span>

<span class="sd">    background_mass: float, optional</span>
<span class="sd">        The mass of the background particle. If not supplied, the default depends</span>
<span class="sd">        on the type of scattering process.</span>

<span class="sd">    max_background_density: float</span>
<span class="sd">        The maximum background density. When the background_density is an expression, this must also</span>
<span class="sd">        be specified.</span>

<span class="sd">    ndt: integer, optional</span>
<span class="sd">        The collisions will be applied every &quot;ndt&quot; steps. Must be 1 or larger.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">species</span><span class="p">,</span> <span class="n">background_density</span><span class="p">,</span>
                 <span class="n">background_temperature</span><span class="p">,</span> <span class="n">scattering_processes</span><span class="p">,</span>
                 <span class="n">background_mass</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_background_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ndt</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_density</span> <span class="o">=</span> <span class="n">background_density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_temperature</span> <span class="o">=</span> <span class="n">background_temperature</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">background_mass</span> <span class="o">=</span> <span class="n">background_mass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scattering_processes</span> <span class="o">=</span> <span class="n">scattering_processes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_background_density</span> <span class="o">=</span> <span class="n">max_background_density</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ndt</span> <span class="o">=</span> <span class="n">ndt</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle_init</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">collision</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">Collisions</span><span class="o">.</span><span class="n">newcollision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">collision</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="s1">&#39;background_mcc&#39;</span>
        <span class="n">collision</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="o">.</span><span class="n">name</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background_density</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">collision</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;background_density(x,y,z,t)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_density</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">collision</span><span class="o">.</span><span class="n">background_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_density</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">background_temperature</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">collision</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;background_temperature(x,y,z,t)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_temperature</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">collision</span><span class="o">.</span><span class="n">background_temperature</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_temperature</span>
        <span class="n">collision</span><span class="o">.</span><span class="n">background_mass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">background_mass</span>
        <span class="n">collision</span><span class="o">.</span><span class="n">max_background_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_background_density</span>
        <span class="n">collision</span><span class="o">.</span><span class="n">ndt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ndt</span>

        <span class="n">collision</span><span class="o">.</span><span class="n">scattering_processes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattering_processes</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">process</span><span class="p">,</span> <span class="n">kw</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">scattering_processes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">kw</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;species&#39;</span><span class="p">:</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">name</span>
                <span class="n">collision</span><span class="o">.</span><span class="n">add_new_attr</span><span class="p">(</span><span class="n">process</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">key</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span></div>


<div class="viewcode-block" id="EmbeddedBoundary"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.EmbeddedBoundary">[docs]</a><span class="k">class</span> <span class="nc">EmbeddedBoundary</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_ClassWithInit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom class to handle set up of embedded boundaries specific to WarpX.</span>
<span class="sd">    If embedded boundary initialization is added to picmistandard this can be</span>
<span class="sd">    changed to inherit that functionality. The geometry can be specified either as</span>
<span class="sd">    an implicit function or as an STL file (ASCII or binary). In the latter case the</span>
<span class="sd">    geometry specified in the STL file can be scaled, translated and inverted.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    implicit_function: string</span>
<span class="sd">        Analytic expression describing the embedded boundary</span>

<span class="sd">    stl_file: string</span>
<span class="sd">        STL file path (string), file contains the embedded boundary geometry</span>

<span class="sd">    stl_scale: float</span>
<span class="sd">        Factor by which the STL geometry is scaled</span>

<span class="sd">    stl_center: vector of floats</span>
<span class="sd">        Vector by which the STL geometry is translated (in meters)</span>

<span class="sd">    stl_reverse_normal: bool</span>
<span class="sd">        If True inverts the orientation of the STL geometry</span>

<span class="sd">    potential: string, default=0.</span>
<span class="sd">        Analytic expression defining the potential. Can only be specified</span>
<span class="sd">        when the solver is electrostatic.</span>

<span class="sd">    cover_multiple_cuts: bool, default=None</span>
<span class="sd">        Whether to cover cells with multiple cuts.</span>
<span class="sd">        (If False, this will raise an error if some cells have multiple cuts)</span>

<span class="sd">    Parameters used in the analytic expressions should be given as additional keyword arguments.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">implicit_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stl_file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stl_scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stl_center</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stl_reverse_normal</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">potential</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cover_multiple_cuts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

        <span class="k">assert</span> <span class="n">stl_file</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">implicit_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Only one between implicit_function and &#39;</span>
                                                                            <span class="s1">&#39;stl_file can be specified&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">implicit_function</span> <span class="o">=</span> <span class="n">implicit_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stl_file</span> <span class="o">=</span> <span class="n">stl_file</span>

        <span class="k">if</span> <span class="n">stl_file</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">stl_scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;EB can only be scaled only when using an stl file&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">stl_center</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;EB can only be translated only when using an stl file&#39;</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">stl_reverse_normal</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;EB can only be reversed only when using an stl file&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stl_scale</span> <span class="o">=</span> <span class="n">stl_scale</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stl_center</span> <span class="o">=</span> <span class="n">stl_center</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stl_reverse_normal</span> <span class="o">=</span> <span class="n">stl_reverse_normal</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">potential</span> <span class="o">=</span> <span class="n">potential</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cover_multiple_cuts</span> <span class="o">=</span> <span class="n">cover_multiple_cuts</span>

        <span class="c1"># Handle keyword arguments used in expressions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">implicit_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b</span><span class="si">%s</span><span class="s1">\b&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">,</span> <span class="n">implicit_function</span><span class="p">)</span> <span class="ow">or</span>
               <span class="p">(</span><span class="n">potential</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b</span><span class="si">%s</span><span class="s1">\b&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">,</span> <span class="n">potential</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle_init</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>

        <span class="c1"># Add the user defined keywords to my_constants</span>
        <span class="c1"># The keywords are mangled if there is a conflicting variable already</span>
        <span class="c1"># defined in my_constants with the same name but different value.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">add_keywords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">implicit_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">implicit_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">eb_implicit_function</span> <span class="o">=</span> <span class="n">expression</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stl_file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">eb2</span><span class="o">.</span><span class="n">geom_type</span> <span class="o">=</span> <span class="s2">&quot;stl&quot;</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">eb2</span><span class="o">.</span><span class="n">stl_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stl_file</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">eb2</span><span class="o">.</span><span class="n">stl_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stl_scale</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">eb2</span><span class="o">.</span><span class="n">stl_center</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stl_center</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">eb2</span><span class="o">.</span><span class="n">stl_reverse_normal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stl_reverse_normal</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">eb2</span><span class="o">.</span><span class="n">cover_multiple_cuts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cover_multiple_cuts</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">potential</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">ElectrostaticSolver</span><span class="p">),</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;The potential is only supported with the ElectrostaticSolver&#39;</span><span class="p">)</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">potential</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;eb_potential(x,y,z,t)&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span></div>


<div class="viewcode-block" id="PlasmaLens"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.PlasmaLens">[docs]</a><span class="k">class</span> <span class="nc">PlasmaLens</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_ClassWithInit</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Custom class to setup a plasma lens lattice.</span>
<span class="sd">    The applied fields are dependent only on the transverse position.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    period: float</span>
<span class="sd">        Periodicity of the lattice (in lab frame, in meters)</span>

<span class="sd">    starts: list of floats</span>
<span class="sd">        The start of each lens relative to the periodic repeat</span>

<span class="sd">    lengths: list of floats</span>
<span class="sd">        The length of each lens</span>

<span class="sd">    strengths_E=None: list of floats, default = 0.</span>
<span class="sd">        The electric field strength of each lens</span>

<span class="sd">    strengths_B=None: list of floats, default = 0.</span>
<span class="sd">        The magnetic field strength of each lens</span>


<span class="sd">    The field that is applied depends on the transverse position of the particle, (x,y)</span>

<span class="sd">    - Ex = x*stengths_E</span>

<span class="sd">    - Ey = y*stengths_E</span>

<span class="sd">    - Bx = +y*stengths_B</span>

<span class="sd">    - By = -x*stengths_B</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">starts</span><span class="p">,</span> <span class="n">lengths</span><span class="p">,</span> <span class="n">strengths_E</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">strengths_B</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">starts</span> <span class="o">=</span> <span class="n">starts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span> <span class="o">=</span> <span class="n">lengths</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strengths_E</span> <span class="o">=</span> <span class="n">strengths_E</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strengths_B</span> <span class="o">=</span> <span class="n">strengths_B</span>

        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strengths_E</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strengths_B</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">),</span>\
               <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;One of strengths_E or strengths_B must be supplied&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle_init</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">E_ext_particle_init_style</span> <span class="o">=</span> <span class="s1">&#39;repeated_plasma_lens&#39;</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">B_ext_particle_init_style</span> <span class="o">=</span> <span class="s1">&#39;repeated_plasma_lens&#39;</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">repeated_plasma_lens_period</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">repeated_plasma_lens_starts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">starts</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">repeated_plasma_lens_lengths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengths</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">repeated_plasma_lens_strengths_E</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strengths_E</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">repeated_plasma_lens_strengths_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">strengths_B</span></div>


<div class="viewcode-block" id="Simulation"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.Simulation">[docs]</a><span class="k">class</span> <span class="nc">Simulation</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_Simulation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    warpx_current_deposition_algo: {&#39;direct&#39;, &#39;esirkepov&#39;, and &#39;vay&#39;}, optional</span>
<span class="sd">        Current deposition algorithm. The default depends on conditions.</span>

<span class="sd">    warpx_charge_deposition_algo: {&#39;standard&#39;}, optional</span>
<span class="sd">        Charge deposition algorithm.</span>

<span class="sd">    warpx_field_gathering_algo: {&#39;energy-conserving&#39;, &#39;momentum-conserving&#39;}, optional</span>
<span class="sd">        Field gathering algorithm. The default depends on conditions.</span>

<span class="sd">    warpx_particle_pusher_algo: {&#39;boris&#39;, &#39;vay&#39;, &#39;higuera&#39;}, default=&#39;boris&#39;</span>
<span class="sd">        Particle pushing algorithm.</span>

<span class="sd">    warpx_use_filter: bool, optional</span>
<span class="sd">        Whether to use filtering. The default depends on the conditions.</span>

<span class="sd">    warpx_do_multi_J: bool, default=0</span>
<span class="sd">        Whether to use the multi-J algorithm, where current deposition and</span>
<span class="sd">        field update are performed multiple times within each time step.</span>

<span class="sd">    warpx_do_multi_J_n_depositions: integer</span>
<span class="sd">        Number of sub-steps to use with the multi-J algorithm, when ``warpx_do_multi_J=1``.</span>
<span class="sd">        Note that this input parameter is not optional and must always be set in all</span>
<span class="sd">        input files where ``warpx.do_multi_J=1``. No default value is provided automatically.</span>

<span class="sd">    warpx_grid_type: {&#39;collocated&#39;, &#39;staggered&#39;, &#39;hybrid&#39;}, default=&#39;staggered&#39;</span>
<span class="sd">        Whether to use a collocated grid (all fields defined at the cell nodes),</span>
<span class="sd">        a staggered grid (fields defined on a Yee grid), or a hybrid grid</span>
<span class="sd">        (fields and currents are interpolated back and forth between a staggered grid</span>
<span class="sd">        and a collocated grid, must be used with momentum-conserving field gathering algorithm).</span>

<span class="sd">    warpx_do_current_centering: bool, optional</span>
<span class="sd">        If true, the current is deposited on a nodal grid and then centered</span>
<span class="sd">        to a staggered grid (Yee grid), using finite-order interpolation.</span>
<span class="sd">        Default: warpx.do_current_centering=0 with collocated or staggered grids,</span>
<span class="sd">        warpx.do_current_centering=1 with hybrid grids.</span>

<span class="sd">    warpx_field_centering_nox/noy/noz: integer, optional</span>
<span class="sd">        The order of interpolation used with staggered or hybrid grids (``warpx_grid_type=staggered``</span>
<span class="sd">        or ``warpx_grid_type=hybrid``) and momentum-conserving field gathering</span>
<span class="sd">        (``warpx_field_gathering_algo=momentum-conserving``) to interpolate the</span>
<span class="sd">        electric and magnetic fields from the cell centers to the cell nodes,</span>
<span class="sd">        before gathering the fields from the cell nodes to the particle positions.</span>
<span class="sd">        Default: ``warpx_field_centering_no&lt;x,y,z&gt;=2`` with staggered grids,</span>
<span class="sd">        ``warpx_field_centering_no&lt;x,y,z&gt;=8`` with hybrid grids (typically necessary</span>
<span class="sd">        to ensure stability in boosted-frame simulations of relativistic plasmas and beams).</span>

<span class="sd">    warpx_current_centering_nox/noy/noz: integer, optional</span>
<span class="sd">        The order of interpolation used with hybrid grids (``warpx_grid_type=hybrid``)</span>
<span class="sd">        to interpolate the currents from the cell nodes to the cell centers when</span>
<span class="sd">        ``warpx_do_current_centering=1``, before pushing the Maxwell fields on staggered grids.</span>
<span class="sd">        Default: ``warpx_current_centering_no&lt;x,y,z&gt;=8`` with hybrid grids (typically necessary</span>
<span class="sd">        to ensure stability in boosted-frame simulations of relativistic plasmas and beams).</span>

<span class="sd">    warpx_serialize_initial_conditions: bool, default=False</span>
<span class="sd">        Controls the random numbers used for initialization.</span>
<span class="sd">        This parameter should only be used for testing and continuous integration.</span>

<span class="sd">    warpx_random_seed: string or int, optional</span>
<span class="sd">        (See documentation)</span>

<span class="sd">    warpx_do_dynamic_scheduling: bool, default=True</span>
<span class="sd">        Whether to do dynamic scheduling with OpenMP</span>

<span class="sd">    warpx_load_balance_intervals: string, default=&#39;0&#39;</span>
<span class="sd">        The intervals for doing load balancing</span>

<span class="sd">    warpx_load_balance_efficiency_ratio_threshold: float, default=1.1</span>
<span class="sd">        (See documentation)</span>

<span class="sd">    warpx_load_balance_with_sfc: bool, default=0</span>
<span class="sd">        (See documentation)</span>

<span class="sd">    warpx_load_balance_knapsack_factor: float, default=1.24</span>
<span class="sd">        (See documentation)</span>

<span class="sd">    warpx_load_balance_costs_update: {&#39;heuristic&#39; or &#39;timers&#39; or &#39;gpuclock&#39;}, optional</span>
<span class="sd">        (See documentation)</span>

<span class="sd">    warpx_costs_heuristic_particles_wt: float, optional</span>
<span class="sd">        (See documentation)</span>

<span class="sd">    warpx_costs_heuristic_cells_wt: float, optional</span>
<span class="sd">        (See documentation)</span>

<span class="sd">    warpx_use_fdtd_nci_corr: bool, optional</span>
<span class="sd">        Whether to use the NCI correction when using the FDTD solver</span>

<span class="sd">    warpx_amr_check_input: bool, optional</span>
<span class="sd">        Whether AMReX should perform checks on the input</span>
<span class="sd">        (primarily related to the max grid size and blocking factors)</span>

<span class="sd">    warpx_amr_restart: string, optional</span>
<span class="sd">        The name of the restart to use</span>

<span class="sd">    warpx_amrex_the_arena_is_managed: bool, optional</span>
<span class="sd">        Whether to use managed memory in the AMReX Arena</span>

<span class="sd">    warpx_amrex_the_arena_init_size: long int, optional</span>
<span class="sd">        The amount of memory in bytes to allocate in the Arena.</span>

<span class="sd">    warpx_amrex_use_gpu_aware_mpi: bool, optional</span>
<span class="sd">        Whether to use GPU-aware MPI communications</span>

<span class="sd">    warpx_zmax_plasma_to_compute_max_step: float, optional</span>
<span class="sd">        Sets the simulation run time based on the maximum z value</span>

<span class="sd">    warpx_compute_max_step_from_btd: bool, default=0</span>
<span class="sd">        If specified, automatically calculates the number of iterations</span>
<span class="sd">        required in the boosted frame for all back-transformed diagnostics</span>
<span class="sd">        to be completed.</span>

<span class="sd">    warpx_collisions: collision instance, optional</span>
<span class="sd">        The collision instance specifying the particle collisions</span>

<span class="sd">    warpx_embedded_boundary: embedded boundary instance, optional</span>

<span class="sd">    warpx_break_signals: list of strings</span>
<span class="sd">        Signals on which to break</span>

<span class="sd">    warpx_checkpoint_signals: list of strings</span>
<span class="sd">        Signals on which to write out a checkpoint</span>

<span class="sd">    warpx_numprocs: list of ints (1 in 1D, 2 in 2D, 3 in 3D)</span>
<span class="sd">        Domain decomposition on the coarsest level.</span>
<span class="sd">        The domain will be chopped into the exact number of pieces in each dimension as specified by this parameter.</span>
<span class="sd">        https://warpx.readthedocs.io/en/latest/usage/parameters.html#distribution-across-mpi-ranks-and-parallelization</span>
<span class="sd">        https://warpx.readthedocs.io/en/latest/usage/domain_decomposition.html#simple-method</span>

<span class="sd">    warpx_sort_intervals: string, optional (defaults: -1 on CPU; 4 on GPU)</span>
<span class="sd">        Using the Intervals parser syntax, this string defines the timesteps at which particles are sorted. If &lt;=0, do not sort particles.</span>
<span class="sd">        It is turned on on GPUs for performance reasons (to improve memory locality).</span>

<span class="sd">    warpx_sort_particles_for_deposition: bool, optional (default: true for the CUDA backend, otherwise false)</span>
<span class="sd">        This option controls the type of sorting used if particle sorting is turned on, i.e. if sort_intervals is not &lt;=0.</span>
<span class="sd">        If `true`, particles will be sorted by cell to optimize deposition with many particles per cell, in the order `x` -&gt; `y` -&gt; `z` -&gt; `ppc`.</span>
<span class="sd">        If `false`, particles will be sorted by bin, using the sort_bin_size parameter below, in the order `ppc` -&gt; `x` -&gt; `y` -&gt; `z`.</span>
<span class="sd">        `true` is recommended for best performance on NVIDIA GPUs, especially if there are many particles per cell.</span>

<span class="sd">    warpx_sort_idx_type: list of int, optional (default: 0 0 0)</span>
<span class="sd">        This controls the type of grid used to sort the particles when sort_particles_for_deposition is true.</span>
<span class="sd">        Possible values are:</span>
<span class="sd">            idx_type = {0, 0, 0}: Sort particles to a cell centered grid,</span>
<span class="sd">            idx_type = {1, 1, 1}: Sort particles to a node centered grid,</span>
<span class="sd">            idx_type = {2, 2, 2}: Compromise between a cell and node centered grid.</span>
<span class="sd">        In 2D (XZ and RZ), only the first two elements are read. In 1D, only the first element is read.</span>

<span class="sd">    warpx_sort_bin_size: list of int, optional (default 1 1 1)</span>
<span class="sd">        If `sort_intervals` is activated and `sort_particles_for_deposition` is false, particles are sorted in bins of `sort_bin_size` cells.</span>
<span class="sd">        In 2D, only the first two elements are read.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set the C++ WarpX interface (see _libwarpx.LibWarpX) as an extension to</span>
    <span class="c1"># Simulation objects. In the future, LibWarpX objects may actually be owned</span>
    <span class="c1"># by Simulation objects to permit multiple WarpX runs simultaneously.</span>
    <span class="n">extension</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">libwarpx</span>

    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">current_deposition_algo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_current_deposition_algo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">charge_deposition_algo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_charge_deposition_algo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_gathering_algo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_field_gathering_algo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle_pusher_algo</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_particle_pusher_algo&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_filter</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_use_filter&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_multi_J</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_multi_J&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_multi_J_n_depositions</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_multi_J_n_depositions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_grid_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_current_centering</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_current_centering&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">field_centering_order</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_field_centering_order&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_centering_order</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_current_centering_order&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">serialize_initial_conditions</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_serialize_initial_conditions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_random_seed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_dynamic_scheduling</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_do_dynamic_scheduling&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_intervals</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_load_balance_intervals&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_efficiency_ratio_threshold</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_load_balance_efficiency_ratio_threshold&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_with_sfc</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_load_balance_with_sfc&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_knapsack_factor</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_load_balance_knapsack_factor&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_costs_update</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_load_balance_costs_update&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">costs_heuristic_particles_wt</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_costs_heuristic_particles_wt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">costs_heuristic_cells_wt</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_costs_heuristic_cells_wt&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_fdtd_nci_corr</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_use_fdtd_nci_corr&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amr_check_input</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_amr_check_input&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amr_restart</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_amr_restart&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amrex_the_arena_is_managed</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_amrex_the_arena_is_managed&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amrex_the_arena_init_size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_amrex_the_arena_init_size&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">amrex_use_gpu_aware_mpi</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_amrex_use_gpu_aware_mpi&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zmax_plasma_to_compute_max_step</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_zmax_plasma_to_compute_max_step&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_max_step_from_btd</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_compute_max_step_from_btd&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_intervals</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_sort_intervals&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_particles_for_deposition</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_sort_particles_for_deposition&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_idx_type</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_sort_idx_type&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_bin_size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_sort_bin_size&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">collisions</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_collisions&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">embedded_boundary</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_embedded_boundary&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">break_signals</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_break_signals&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_signals</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_checkpoint_signals&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numprocs</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_numprocs&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inputs_initialized</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">warpx_initialized</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">inputs_initialized</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">inputs_initialized</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_step_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">const_dt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_step_size</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_boost</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">gamma_boost</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_boost</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">boost_direction</span> <span class="o">=</span> <span class="s1">&#39;z&#39;</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">zmax_plasma_to_compute_max_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zmax_plasma_to_compute_max_step</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">compute_max_step_from_btd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_max_step_from_btd</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">sort_intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_intervals</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">sort_particles_for_deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_particles_for_deposition</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">sort_idx_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_idx_type</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">sort_bin_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sort_bin_size</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">current_deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_deposition_algo</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">charge_deposition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_deposition_algo</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">field_gathering</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_gathering_algo</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">particle_pusher</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_pusher_algo</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">load_balance_intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_intervals</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">load_balance_efficiency_ratio_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_efficiency_ratio_threshold</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">load_balance_with_sfc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_with_sfc</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">load_balance_knapsack_factor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_knapsack_factor</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">load_balance_costs_update</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_balance_costs_update</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">costs_heuristic_particles_wt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">costs_heuristic_particles_wt</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">costs_heuristic_cells_wt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">costs_heuristic_cells_wt</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">grid_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grid_type</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_current_centering</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_current_centering</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">use_filter</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_filter</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_multi_J</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_multi_J</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_multi_J_n_depositions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_multi_J_n_depositions</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">serialize_initial_conditions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">serialize_initial_conditions</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">random_seed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_seed</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">do_dynamic_scheduling</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">do_dynamic_scheduling</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">particles</span><span class="o">.</span><span class="n">use_fdtd_nci_corr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_fdtd_nci_corr</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">check_input</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amr_check_input</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">break_signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">break_signals</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">checkpoint_signals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">checkpoint_signals</span>

        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">numprocs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">numprocs</span>

        <span class="n">particle_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_shape</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">particle_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">particle_shape</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">particle_shape</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">particle_shape</span><span class="p">,</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;WarpX only supports one particle shape for all species&#39;</span><span class="p">)</span>
                <span class="c1"># --- If this was set for any species, use that value.</span>
                <span class="n">particle_shape</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">particle_shape</span>

        <span class="k">if</span> <span class="n">particle_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lasers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">particle_shape</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="n">interpolation_order</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;NGP&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;quadratic&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">}[</span><span class="n">particle_shape</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">interpolation_order</span> <span class="o">=</span> <span class="n">particle_shape</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">algo</span><span class="o">.</span><span class="n">particle_shape</span> <span class="o">=</span> <span class="n">interpolation_order</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>

        <span class="c1"># Initialize warpx.field_centering_no&lt;x,y,z&gt; and warpx.current_centering_no&lt;x,y,z&gt;</span>
        <span class="c1"># if set by the user in the input (need to access grid info from solver attribute)</span>
        <span class="c1"># warpx.field_centering_no&lt;x,y,z&gt;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_centering_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">field_centering_nox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_centering_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">number_of_dimensions</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">field_centering_noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_centering_order</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">field_centering_noz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">field_centering_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="c1"># warpx.current_centering_no&lt;x,y,z&gt;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_centering_order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">current_centering_nox</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_centering_order</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">number_of_dimensions</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">current_centering_noy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_centering_order</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">current_centering_noz</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_centering_order</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layouts</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">initialize_self_fields</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">injection_plane_positions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                              <span class="bp">self</span><span class="o">.</span><span class="n">injection_plane_normal_vectors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">interaction</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">interactions</span><span class="p">:</span>
            <span class="k">assert</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">interaction</span><span class="p">,</span> <span class="n">FieldIonization</span><span class="p">))</span>
            <span class="n">interaction</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collisions</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">collisions</span><span class="o">.</span><span class="n">collision_names</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">collision</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">collisions</span><span class="p">:</span>
                <span class="n">pywarpx</span><span class="o">.</span><span class="n">collisions</span><span class="o">.</span><span class="n">collision_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collision</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="n">collision</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedded_boundary</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedded_boundary</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">solver</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lasers</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lasers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">laser_injection_methods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lasers</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">applied_field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">applied_fields</span><span class="p">:</span>
            <span class="n">applied_field</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">diagnostic</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">diagnostics</span><span class="p">:</span>
            <span class="n">diagnostic</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">amr_restart</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amr</span><span class="o">.</span><span class="n">restart</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amr_restart</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrex_the_arena_is_managed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amrex</span><span class="o">.</span><span class="n">the_arena_is_managed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrex_the_arena_is_managed</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrex_the_arena_init_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amrex</span><span class="o">.</span><span class="n">the_arena_init_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrex_the_arena_init_size</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrex_use_gpu_aware_mpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">amrex</span><span class="o">.</span><span class="n">use_gpu_aware_mpi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">amrex_use_gpu_aware_mpi</span>

    <span class="k">def</span> <span class="nf">initialize_warpx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mpi_comm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpx_initialized</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">warpx_initialized</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">mpi_comm</span><span class="p">,</span> <span class="n">max_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_steps</span><span class="p">,</span> <span class="n">stop_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_time</span><span class="p">)</span>

<div class="viewcode-block" id="Simulation.write_input_file"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.Simulation.write_input_file">[docs]</a>    <span class="k">def</span> <span class="nf">write_input_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;inputs&#39;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">write_inputs</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">max_step</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_steps</span><span class="p">,</span> <span class="n">stop_time</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_time</span><span class="p">)</span></div>

<div class="viewcode-block" id="Simulation.step"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.Simulation.step">[docs]</a>    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nsteps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mpi_comm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_inputs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">initialize_warpx</span><span class="p">(</span><span class="n">mpi_comm</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nsteps</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_steps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">nsteps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_steps</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nsteps</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">evolve</span><span class="p">(</span><span class="n">nsteps</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">finalize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">warpx_initialized</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">warpx_initialized</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">pywarpx</span><span class="o">.</span><span class="n">warpx</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span></div>


<span class="c1"># ----------------------------</span>
<span class="c1"># Simulation frame diagnostics</span>
<span class="c1"># ----------------------------</span>

<span class="k">class</span> <span class="nc">WarpXDiagnosticBase</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for all WarpX diagnostic containing functionality shared by</span>
<span class="sd">    all WarpX diagnostic installations.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">add_diagnostic</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># reduced diagnostics go in a different bucket than regular diagnostics</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ReducedDiagnostic</span><span class="p">):</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">reduced_diagnostics</span>
            <span class="n">name_template</span> <span class="o">=</span> <span class="s1">&#39;reduced_diag&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bucket</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">diagnostics</span>
            <span class="n">name_template</span> <span class="o">=</span> <span class="s1">&#39;diag&#39;</span>

        <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">diagnostics_number</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">bucket</span><span class="o">.</span><span class="n">_diagnostics_dict</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name_template</span><span class="si">}{</span><span class="n">diagnostics_number</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span> <span class="o">=</span> <span class="n">bucket</span><span class="o">.</span><span class="n">_diagnostics_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">Diagnostics</span><span class="o">.</span><span class="n">Diagnostic</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">_species_dict</span><span class="o">=</span><span class="p">{}</span>
            <span class="p">)</span>
            <span class="n">bucket</span><span class="o">.</span><span class="n">_diagnostics_dict</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span>

    <span class="k">def</span> <span class="nf">set_write_dir</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_dir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">write_dir</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_dir</span> <span class="ow">or</span> <span class="s1">&#39;diags&#39;</span><span class="p">)</span>
            <span class="n">file_prefix</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">file_prefix</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">write_dir</span><span class="p">,</span> <span class="n">file_prefix</span><span class="p">)</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">ParticleFieldDiagnostic</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class holding particle field diagnostic information to be processed in FieldDiagnostic below.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    name: str</span>
<span class="sd">        Name of particle field diagnostic. If a component of a vector field, for the openPMD viewer</span>
<span class="sd">        to treat it as a vector, the coordinate (i.e x, y, z) should be the last character.</span>

<span class="sd">    func: parser str</span>
<span class="sd">        Parser function to be calculated for each particle per cell. Should be of the form</span>
<span class="sd">        f(x,y,z,ux,uy,uz)</span>

<span class="sd">    do_average: (0 or 1) optional, default 1</span>
<span class="sd">        Whether the diagnostic is averaged by the sum of particle weights in each cell</span>

<span class="sd">    filter: parser str, optional</span>
<span class="sd">        Parser function returning a boolean for whether to include a particle in the diagnostic.</span>
<span class="sd">        If not specified, all particles will be included. The function arguments are the same</span>
<span class="sd">        as the `func` above.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">func</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">do_average</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="FieldDiagnostic"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.FieldDiagnostic">[docs]</a><span class="k">class</span> <span class="nc">FieldDiagnostic</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_FieldDiagnostic</span><span class="p">,</span> <span class="n">WarpXDiagnosticBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    warpx_plot_raw_fields: bool, optional</span>
<span class="sd">        Flag whether to dump the raw fields</span>

<span class="sd">    warpx_plot_raw_fields_guards: bool, optional</span>
<span class="sd">        Flag whether the raw fields should include the guard cells</span>

<span class="sd">    warpx_write_species: bool, optional</span>
<span class="sd">        Flag whether to output particle data with the diagnostic</span>

<span class="sd">    warpx_format: {plotfile, checkpoint, openpmd, ascent, sensei}, optional</span>
<span class="sd">        Diagnostic file format</span>

<span class="sd">    warpx_openpmd_backend: {bp, h5, json}, optional</span>
<span class="sd">        Openpmd backend file format</span>

<span class="sd">    warpx_file_prefix: string, optional</span>
<span class="sd">        Prefix on the diagnostic file name</span>

<span class="sd">    warpx_file_min_digits: integer, optional</span>
<span class="sd">        Minimum number of digits for the time step number in the file name</span>

<span class="sd">    warpx_dump_rz_modes: bool, optional</span>
<span class="sd">        Flag whether to dump the data for all RZ modes</span>

<span class="sd">    warpx_particle_fields_to_plot: list of ParticleFieldDiagnostics</span>
<span class="sd">        List of ParticleFieldDiagnostic classes to install in the simulation. Error</span>
<span class="sd">        checking is handled in the class itself.</span>

<span class="sd">    warpx_particle_fields_species: list of strings, optional</span>
<span class="sd">        Species for which to calculate particle_fields_to_plot functions. Fields will</span>
<span class="sd">        be calculated separately for each specified species. If not passed, default is</span>
<span class="sd">        all of the available particle species.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plot_raw_fields</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_plot_raw_fields&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_raw_fields_guards</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_plot_raw_fields_guards&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_finepatch</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_plot_finepatch&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_crsepatch</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_plot_crsepatch&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_species</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_write_species&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_format&#39;</span><span class="p">,</span> <span class="s1">&#39;plotfile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_backend</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_openpmd_backend&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_prefix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_min_digits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dump_rz_modes</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_dump_rz_modes&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle_fields_to_plot</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_particle_fields_to_plot&#39;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">particle_fields_species</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_particle_fields_species&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_diagnostic</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">diag_type</span> <span class="o">=</span> <span class="s1">&#39;Full&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">openpmd_backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">dump_rz_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dump_rz_modes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">diag_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">diag_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">number_of_cells</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">coarsening_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">grid</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">number_of_cells</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># --- Use a set to ensure that fields don&#39;t get repeated.</span>
        <span class="n">fields_to_plot</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dims</span> <span class="o">==</span> <span class="s1">&#39;RZ&#39;</span><span class="p">:</span>
            <span class="n">E_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Er&#39;</span><span class="p">,</span> <span class="s1">&#39;Et&#39;</span><span class="p">,</span> <span class="s1">&#39;Ez&#39;</span><span class="p">]</span>
            <span class="n">B_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Br&#39;</span><span class="p">,</span> <span class="s1">&#39;Bt&#39;</span><span class="p">,</span> <span class="s1">&#39;Bz&#39;</span><span class="p">]</span>
            <span class="n">J_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jr&#39;</span><span class="p">,</span> <span class="s1">&#39;Jt&#39;</span><span class="p">,</span> <span class="s1">&#39;Jz&#39;</span><span class="p">]</span>
            <span class="n">A_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ar&#39;</span><span class="p">,</span> <span class="s1">&#39;At&#39;</span><span class="p">,</span> <span class="s1">&#39;Az&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">E_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ey&#39;</span><span class="p">,</span> <span class="s1">&#39;Ez&#39;</span><span class="p">]</span>
            <span class="n">B_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bx&#39;</span><span class="p">,</span> <span class="s1">&#39;By&#39;</span><span class="p">,</span> <span class="s1">&#39;Bz&#39;</span><span class="p">]</span>
            <span class="n">J_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jx&#39;</span><span class="p">,</span> <span class="s1">&#39;Jy&#39;</span><span class="p">,</span> <span class="s1">&#39;Jz&#39;</span><span class="p">]</span>
            <span class="n">A_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ax&#39;</span><span class="p">,</span> <span class="s1">&#39;Ay&#39;</span><span class="p">,</span> <span class="s1">&#39;Az&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">E_fields_list</span><span class="p">:</span>
                        <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">B_fields_list</span><span class="p">:</span>
                        <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;J&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">J_fields_list</span><span class="p">:</span>
                        <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">A_fields_list</span><span class="p">:</span>
                        <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="n">E_fields_list</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="n">B_fields_list</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="n">A_fields_list</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;rho&#39;</span><span class="p">,</span> <span class="s1">&#39;phi&#39;</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;divE&#39;</span><span class="p">,</span> <span class="s1">&#39;divB&#39;</span><span class="p">,</span> <span class="s1">&#39;proc_number&#39;</span><span class="p">,</span> <span class="s1">&#39;part_per_cell&#39;</span><span class="p">]:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="n">J_fields_list</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">dataname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;rho_&#39;</span><span class="p">):</span>
                    <span class="c1"># Adds rho_species diagnostic</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;dive&#39;</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;divE&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;divb&#39;</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;divB&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;raw_fields&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_raw_fields</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;raw_fields_guards&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_raw_fields_guards</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;finepatch&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_finepatch</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;crsepatch&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">plot_crsepatch</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;none&#39;</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span> <span class="o">=</span> <span class="nb">set</span><span class="p">((</span><span class="s1">&#39;none&#39;</span><span class="p">,))</span>

            <span class="c1"># --- Convert the set to a sorted list so that the order</span>
            <span class="c1"># --- is the same on all processors.</span>
            <span class="n">fields_to_plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields_to_plot</span><span class="p">)</span>
            <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">fields_to_plot</span> <span class="o">=</span> <span class="n">fields_to_plot</span>

        <span class="n">particle_fields_to_plot_names</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">pfd</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_fields_to_plot</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pfd</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">particle_fields_to_plot_names</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;A particle fields name can not be repeated.&#39;</span><span class="p">)</span>
            <span class="n">particle_fields_to_plot_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pfd</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;particle_fields.</span><span class="si">{</span><span class="n">pfd</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">(x,y,z,ux,uy,uz)&#39;</span><span class="p">,</span> <span class="n">pfd</span><span class="o">.</span><span class="n">func</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;particle_fields.</span><span class="si">{</span><span class="n">pfd</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.do_average&#39;</span><span class="p">,</span> <span class="n">pfd</span><span class="o">.</span><span class="n">do_average</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;particle_fields.</span><span class="si">{</span><span class="n">pfd</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">.filter(x,y,z,ux,uy,uz)&#39;</span><span class="p">,</span> <span class="n">pfd</span><span class="o">.</span><span class="n">filter</span>
            <span class="p">)</span>

        <span class="c1"># --- Convert to a sorted list so that the order</span>
        <span class="c1"># --- is the same on all processors.</span>
        <span class="n">particle_fields_to_plot_names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">particle_fields_to_plot</span> <span class="o">=</span> <span class="n">particle_fields_to_plot_names</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">particle_fields_species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">particle_fields_species</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">plot_raw_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_raw_fields</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">plot_raw_fields_guards</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_raw_fields_guards</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">plot_finepatch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_finepatch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">plot_crsepatch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_crsepatch</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">write_species</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_species</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_write_dir</span><span class="p">()</span></div>


<span class="n">ElectrostaticFieldDiagnostic</span> <span class="o">=</span> <span class="n">FieldDiagnostic</span>


<div class="viewcode-block" id="Checkpoint"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.Checkpoint">[docs]</a><span class="k">class</span> <span class="nc">Checkpoint</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_ClassWithInit</span><span class="p">,</span> <span class="n">WarpXDiagnosticBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up checkpointing of the simulation, allowing for later restarts</span>

<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    warpx_file_prefix: string</span>
<span class="sd">        The prefix to the checkpoint directory names</span>

<span class="sd">    warpx_file_min_digits: integer</span>
<span class="sd">        Minimum number of digits for the time step number in the checkpoint</span>
<span class="sd">        directory name.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">period</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">write_dir</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">period</span> <span class="o">=</span> <span class="n">period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_dir</span> <span class="o">=</span> <span class="n">write_dir</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_prefix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_min_digits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;chkpoint&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle_init</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_diagnostic</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">diag_type</span> <span class="o">=</span> <span class="s1">&#39;Full&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="s1">&#39;checkpoint&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_write_dir</span><span class="p">()</span></div>


<div class="viewcode-block" id="ParticleDiagnostic"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.ParticleDiagnostic">[docs]</a><span class="k">class</span> <span class="nc">ParticleDiagnostic</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_ParticleDiagnostic</span><span class="p">,</span> <span class="n">WarpXDiagnosticBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html&gt;`_ for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    warpx_format: {plotfile, checkpoint, openpmd, ascent, sensei}, optional</span>
<span class="sd">        Diagnostic file format</span>

<span class="sd">    warpx_openpmd_backend: {bp, h5, json}, optional</span>
<span class="sd">        Openpmd backend file format</span>

<span class="sd">    warpx_file_prefix: string, optional</span>
<span class="sd">        Prefix on the diagnostic file name</span>

<span class="sd">    warpx_file_min_digits: integer, optional</span>
<span class="sd">        Minimum number of digits for the time step number in the file name</span>

<span class="sd">    warpx_random_fraction: float, optional</span>
<span class="sd">        Random fraction of particles to include in the diagnostic</span>

<span class="sd">    warpx_uniform_stride: integer, optional</span>
<span class="sd">        Stride to down select to the particles to include in the diagnostic</span>

<span class="sd">    warpx_plot_filter_function: string, optional</span>
<span class="sd">        Analytic expression to down select the particles to in the diagnostic</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_format&#39;</span><span class="p">,</span> <span class="s1">&#39;plotfile&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_backend</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_openpmd_backend&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_prefix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_min_digits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">random_fraction</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_random_fraction&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uniform_stride</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_uniform_stride&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_filter_function</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_plot_filter_function&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_filter_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># This allows variables to be used in the plot_filter_function, but</span>
            <span class="c1"># in order not to break other codes, the variables must begin with &quot;warpx_&quot;</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;warpx_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b</span><span class="si">%s</span><span class="s1">\b&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_filter_function</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                    <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_diagnostic</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">diag_type</span> <span class="o">=</span> <span class="s1">&#39;Full&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">openpmd_backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">period</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_write_dir</span><span class="p">()</span>

        <span class="c1"># --- Use a set to ensure that fields don&#39;t get repeated.</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span>
                    <span class="c1"># --- The positions are alway written out anyway</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;momentum&#39;</span><span class="p">:</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;ux&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;uy&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;uz&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;weighting&#39;</span><span class="p">:</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;fields&#39;</span><span class="p">:</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Bx&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;By&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Bz&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ux&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">,</span> <span class="s1">&#39;uz&#39;</span><span class="p">,</span> <span class="s1">&#39;Ex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ey&#39;</span><span class="p">,</span> <span class="s1">&#39;Ez&#39;</span><span class="p">,</span> <span class="s1">&#39;Bx&#39;</span><span class="p">,</span> <span class="s1">&#39;By&#39;</span><span class="p">,</span> <span class="s1">&#39;Bz&#39;</span><span class="p">]:</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>

            <span class="c1"># --- Convert the set to a sorted list so that the order</span>
            <span class="c1"># --- is the same on all processors.</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
            <span class="n">variables</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># species list</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">):</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Only do this once so that the same variables are used in this distribution</span>
            <span class="c1"># is used multiple times</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">add_keywords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="n">species_list</span><span class="p">:</span>
            <span class="n">diag</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">Bucket</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">specie</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                         <span class="n">variables</span> <span class="o">=</span> <span class="n">variables</span><span class="p">,</span>
                                         <span class="n">random_fraction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">random_fraction</span><span class="p">,</span>
                                         <span class="n">uniform_stride</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">uniform_stride</span><span class="p">)</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">plot_filter_function</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
            <span class="n">diag</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s1">&#39;plot_filter_function(t,x,y,z,ux,uy,uz)&#39;</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">_species_dict</span><span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">diag</span></div>

<span class="c1"># ----------------------------</span>
<span class="c1"># Lab frame diagnostics</span>
<span class="c1"># ----------------------------</span>


<div class="viewcode-block" id="LabFrameFieldDiagnostic"><a class="viewcode-back" href="../../usage/python.html#pywarpx.picmi.LabFrameFieldDiagnostic">[docs]</a><span class="k">class</span> <span class="nc">LabFrameFieldDiagnostic</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_LabFrameFieldDiagnostic</span><span class="p">,</span>
                              <span class="n">WarpXDiagnosticBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html#backtransformed-diagnostics&gt;`_</span>
<span class="sd">    for more information.</span>

<span class="sd">    This will by default write out both field and particle data. This can be changed by setting warpx_write_species.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    warpx_format: string, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.format</span>

<span class="sd">    warpx_openpmd_backend: string, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.openpmd_backend</span>

<span class="sd">    warpx_file_prefix: string, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.file_prefix</span>

<span class="sd">    warpx_intervals: integer or string</span>
<span class="sd">        Selects the snapshots to be made, instead of using &quot;num_snapshots&quot; which</span>
<span class="sd">        makes all snapshots. &quot;num_snapshots&quot; is ignored.</span>

<span class="sd">    warpx_file_min_digits: integer, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.file_min_digits</span>

<span class="sd">    warpx_buffer_size: integer, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.buffer_size</span>

<span class="sd">    warpx_lower_bound: vector of floats, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.lower_bound</span>

<span class="sd">    warpx_upper_bound: vector of floats, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.upper_bound</span>

<span class="sd">    warpx_write_species: bool, optional, default=True</span>
<span class="sd">        Whether the species will also be written out.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_backend</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_openpmd_backend&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_prefix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_intervals&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_min_digits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_buffer_size&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_lower_bound&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_upper_bound&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_species</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_write_species&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_diagnostic</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">diag_type</span> <span class="o">=</span> <span class="s1">&#39;BackTransformed&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">openpmd_backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">diag_lo</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lower_bound</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">diag_hi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">upper_bound</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">do_back_transformed_fields</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">dt_snapshots_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt_snapshots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span>

        <span class="c1"># intervals and num_snapshots_lab cannot both be set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">num_snapshots_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_snapshots</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">do_back_transformed_particles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_species</span>

        <span class="c1"># --- Use a set to ensure that fields don&#39;t get repeated.</span>
        <span class="n">fields_to_plot</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">dims</span> <span class="o">==</span> <span class="s1">&#39;RZ&#39;</span><span class="p">:</span>
            <span class="n">E_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Er&#39;</span><span class="p">,</span> <span class="s1">&#39;Et&#39;</span><span class="p">,</span> <span class="s1">&#39;Ez&#39;</span><span class="p">]</span>
            <span class="n">B_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Br&#39;</span><span class="p">,</span> <span class="s1">&#39;Bt&#39;</span><span class="p">,</span> <span class="s1">&#39;Bz&#39;</span><span class="p">]</span>
            <span class="n">J_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jr&#39;</span><span class="p">,</span> <span class="s1">&#39;Jt&#39;</span><span class="p">,</span> <span class="s1">&#39;Jz&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">E_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ey&#39;</span><span class="p">,</span> <span class="s1">&#39;Ez&#39;</span><span class="p">]</span>
            <span class="n">B_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Bx&#39;</span><span class="p">,</span> <span class="s1">&#39;By&#39;</span><span class="p">,</span> <span class="s1">&#39;Bz&#39;</span><span class="p">]</span>
            <span class="n">J_fields_list</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jx&#39;</span><span class="p">,</span> <span class="s1">&#39;Jy&#39;</span><span class="p">,</span> <span class="s1">&#39;Jz&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">E_fields_list</span><span class="p">:</span>
                        <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">B_fields_list</span><span class="p">:</span>
                        <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;J&#39;</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">J_fields_list</span><span class="p">:</span>
                        <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">field_name</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="n">E_fields_list</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="n">B_fields_list</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="n">J_fields_list</span><span class="p">:</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">elif</span> <span class="n">dataname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;rho_&#39;</span><span class="p">):</span>
                    <span class="c1"># Adds rho_species diagnostic</span>
                    <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>

            <span class="c1"># --- Convert the set to a sorted list so that the order</span>
            <span class="c1"># --- is the same on all processors.</span>
            <span class="n">fields_to_plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">fields_to_plot</span><span class="p">)</span>
            <span class="n">fields_to_plot</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">fields_to_plot</span> <span class="o">=</span> <span class="n">fields_to_plot</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_write_dir</span><span class="p">()</span></div>


<span class="k">class</span> <span class="nc">LabFrameParticleDiagnostic</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">PICMI_LabFrameParticleDiagnostic</span><span class="p">,</span>
                                 <span class="n">WarpXDiagnosticBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html#backtransformed-diagnostics&gt;`_</span>
<span class="sd">    for more information.</span>

<span class="sd">    This will by default write out both field and particle data. This can be changed by setting warpx_write_fields.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    warpx_format: string, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.format</span>

<span class="sd">    warpx_openpmd_backend: string, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.openpmd_backend</span>

<span class="sd">    warpx_file_prefix: string, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.file_prefix</span>

<span class="sd">    warpx_intervals: integer or string</span>
<span class="sd">        Selects the snapshots to be made, instead of using &quot;num_snapshots&quot; which</span>
<span class="sd">        makes all snapshots. &quot;num_snapshots&quot; is ignored.</span>

<span class="sd">    warpx_file_min_digits: integer, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.file_min_digits</span>

<span class="sd">    warpx_buffer_size: integer, optional</span>
<span class="sd">        Passed to &lt;diagnostic name&gt;.buffer_size</span>

<span class="sd">    warpx_write_fields: bool, optional, default=True</span>
<span class="sd">        Whether the fields will also be written out.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_format&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_backend</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_openpmd_backend&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_prefix</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_prefix&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_intervals&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_file_min_digits&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_buffer_size&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_fields</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;warpx_write_fields&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_diagnostic</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">diag_type</span> <span class="o">=</span> <span class="s1">&#39;BackTransformed&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">openpmd_backend</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">openpmd_backend</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">file_min_digits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_min_digits</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">do_back_transformed_particles</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">dt_snapshots_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dt_snapshots</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">buffer_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">buffer_size</span>

        <span class="c1"># intervals and num_snapshots_lab cannot both be set</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">intervals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">num_snapshots_lab</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_snapshots</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">do_back_transformed_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_fields</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">set_write_dir</span><span class="p">()</span>

        <span class="c1"># --- Use a set to ensure that fields don&#39;t get repeated.</span>
        <span class="n">variables</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_list</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;position&#39;</span><span class="p">:</span>
                    <span class="c1"># --- The positions are alway written out anyway</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;momentum&#39;</span><span class="p">:</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;ux&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;uy&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;uz&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;weighting&#39;</span><span class="p">:</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="o">==</span> <span class="s1">&#39;fields&#39;</span><span class="p">:</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Ex&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Ey&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Ez&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Bx&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;By&#39;</span><span class="p">)</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Bz&#39;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">dataname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ux&#39;</span><span class="p">,</span> <span class="s1">&#39;uy&#39;</span><span class="p">,</span> <span class="s1">&#39;uz&#39;</span><span class="p">,</span> <span class="s1">&#39;Ex&#39;</span><span class="p">,</span> <span class="s1">&#39;Ey&#39;</span><span class="p">,</span> <span class="s1">&#39;Ez&#39;</span><span class="p">,</span> <span class="s1">&#39;Bx&#39;</span><span class="p">,</span> <span class="s1">&#39;By&#39;</span><span class="p">,</span> <span class="s1">&#39;Bz&#39;</span><span class="p">,</span> <span class="s1">&#39;Er&#39;</span><span class="p">,</span> <span class="s1">&#39;Et&#39;</span><span class="p">,</span> <span class="s1">&#39;Br&#39;</span><span class="p">,</span> <span class="s1">&#39;Bt&#39;</span><span class="p">]:</span>
                    <span class="n">variables</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">dataname</span><span class="p">)</span>

            <span class="c1"># --- Convert the set to a sorted list so that the order</span>
            <span class="c1"># --- is the same on all processors.</span>
            <span class="n">variables</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
            <span class="n">variables</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># species list</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iterable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">):</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">species</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">species_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">species</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">specie</span> <span class="ow">in</span> <span class="n">species_list</span><span class="p">:</span>
            <span class="n">diag</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">Bucket</span><span class="o">.</span><span class="n">Bucket</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="n">specie</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                         <span class="n">variables</span> <span class="o">=</span> <span class="n">variables</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="n">_species_dict</span><span class="p">[</span><span class="n">specie</span><span class="o">.</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">diag</span>


<span class="k">class</span> <span class="nc">ReducedDiagnostic</span><span class="p">(</span><span class="n">picmistandard</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">_ClassWithInit</span><span class="p">,</span> <span class="n">WarpXDiagnosticBase</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sets up a reduced diagnostic in the simulation.</span>

<span class="sd">    See `Input Parameters &lt;https://warpx.readthedocs.io/en/latest/usage/parameters.html#reduced-diagnostics&gt;`_</span>
<span class="sd">    for more information.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    diag_type: string</span>
<span class="sd">        The type of reduced diagnostic. See the link above for all the different</span>
<span class="sd">        types of reduced diagnostics available.</span>

<span class="sd">    name: string</span>
<span class="sd">        The name of this diagnostic which will also be the name of the data</span>
<span class="sd">        file written to disk.</span>

<span class="sd">    period: integer</span>
<span class="sd">        The simulation step interval at which to output this diagnostic.</span>

<span class="sd">    path: string</span>
<span class="sd">        The file path in which the diagnostic file should be written.</span>

<span class="sd">    extension: string</span>
<span class="sd">        The file extension used for the diagnostic output.</span>

<span class="sd">    separator: string</span>
<span class="sd">        The separator between row values in the output file.</span>

<span class="sd">    species: species instance</span>
<span class="sd">        The name of the species for which to calculate the diagnostic, required for</span>
<span class="sd">        diagnostic types &#39;BeamRelevant&#39;, &#39;ParticleHistogram&#39;, and &#39;ParticleExtrema&#39;</span>

<span class="sd">    bin_number: integer</span>
<span class="sd">        For diagnostic type &#39;ParticleHistogram&#39;, the number of bins used for the histogram</span>

<span class="sd">    bin_max: float</span>
<span class="sd">        For diagnostic type &#39;ParticleHistogram&#39;, the maximum value of the bins</span>

<span class="sd">    bin_min: float</span>
<span class="sd">        For diagnostic type &#39;ParticleHistogram&#39;, the minimum value of the bins</span>

<span class="sd">    normalization: {&#39;unity_particle_weight&#39;, &#39;max_to_unity&#39;, &#39;area_to_unity&#39;}, optional</span>
<span class="sd">        For diagnostic type &#39;ParticleHistogram&#39;, normalization method of the histogram.</span>

<span class="sd">    histogram_function: string</span>
<span class="sd">        For diagnostic type &#39;ParticleHistogram&#39;, the function evaluated to produce the histogram data</span>

<span class="sd">    filter_function: string, optional</span>
<span class="sd">        For diagnostic type &#39;ParticleHistogram&#39;, the function to filter whether particles are included in the histogram</span>

<span class="sd">    reduced_function: string</span>
<span class="sd">        For diagnostic type &#39;FieldReduction&#39;, the function of the fields to evaluate</span>

<span class="sd">    weighting_function: string, optional</span>
<span class="sd">        For diagnostic type &#39;ChargeOnEB&#39;, the function to weight contributions to the total charge</span>

<span class="sd">    reduction_type: {&#39;Maximum&#39;, &#39;Minimum&#39;, or &#39;Integral&#39;}</span>
<span class="sd">        For diagnostic type &#39;FieldReduction&#39;, the type of reduction</span>

<span class="sd">    probe_geometry: {&#39;Point&#39;, &#39;Line&#39;, &#39;Plane&#39;}, defaut=&#39;Point&#39;</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, the geometry of the probe</span>

<span class="sd">    integrate: bool, default=false</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, whether the field is integrated</span>

<span class="sd">    do_moving_window_FP: bool, default=False</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, whether the moving window is followed</span>

<span class="sd">    x_probe, y_probe, z_probe: floats</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, a probe location. For &#39;Point&#39;, the location of the point. For &#39;Line&#39;, the start of the</span>
<span class="sd">        line. For &#39;Plane&#39;, the center of the square detector.</span>

<span class="sd">    interp_order: integer</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, the interpolation order for &#39;Line&#39; and &#39;Plane&#39;</span>

<span class="sd">    resolution: integer</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, the number of points along the &#39;Line&#39; or along each edge of the square &#39;Plane&#39;</span>

<span class="sd">    x1_probe, y1_probe, z1_probe: floats</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, the end point for &#39;Line&#39;</span>

<span class="sd">    detector_radius: float</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, the detector &quot;radius&quot; (half edge length) of the &#39;Plane&#39;</span>

<span class="sd">    target_normal_x, target_normal_y, target_normal_z: floats</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, the normal vector to the &#39;Plane&#39;. Only applicable in 3D</span>

<span class="sd">    target_up_x, target_up_y, target_up_z: floats</span>
<span class="sd">        For diagnostic type &#39;FieldProbe&#39;, the vector specifying up in the &#39;Plane&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">diag_type</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">period</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">extension</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">separator</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">diag_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intervals</span> <span class="o">=</span> <span class="n">period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">extension</span> <span class="o">=</span> <span class="n">extension</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">separator</span> <span class="o">=</span> <span class="n">separator</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Now we need to handle all the specific inputs required for the</span>
        <span class="c1"># different reduced diagnostic types.</span>

        <span class="c1"># The simple diagnostics do not require any additional arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_simple_reduced_diagnostics</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;ParticleEnergy&#39;</span><span class="p">,</span> <span class="s1">&#39;ParticleMomentum&#39;</span><span class="p">,</span> <span class="s1">&#39;FieldEnergy&#39;</span><span class="p">,</span>
            <span class="s1">&#39;FieldMomentum&#39;</span><span class="p">,</span> <span class="s1">&#39;FieldMaximum&#39;</span><span class="p">,</span> <span class="s1">&#39;RhoMaximum&#39;</span><span class="p">,</span> <span class="s1">&#39;ParticleNumber&#39;</span><span class="p">,</span>
            <span class="s1">&#39;LoadBalanceCosts&#39;</span><span class="p">,</span> <span class="s1">&#39;LoadBalanceEfficiency&#39;</span>
        <span class="p">]</span>
        <span class="c1"># The species diagnostics require a species to be provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_species_reduced_diagnostics</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;BeamRelevant&#39;</span><span class="p">,</span> <span class="s1">&#39;ParticleHistogram&#39;</span><span class="p">,</span> <span class="s1">&#39;ParticleExtrema&#39;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_simple_reduced_diagnostics</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_species_reduced_diagnostics</span><span class="p">:</span>
            <span class="n">species</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;species&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">species</span> <span class="o">=</span> <span class="n">species</span><span class="o">.</span><span class="n">name</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s1">&#39;ParticleHistogram&#39;</span><span class="p">:</span>
                <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_particle_histogram</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;FieldProbe&quot;</span><span class="p">:</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_field_probe</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;FieldReduction&quot;</span><span class="p">:</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_field_reduction</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;ChargeOnEB&quot;</span><span class="p">:</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_charge_on_eb</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="si">}</span><span class="s2"> reduced diagnostic is not yet supported &quot;</span>
                <span class="s2">&quot;in pywarpx.&quot;</span>
            <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">handle_init</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_handle_field_probe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Utility function to grab required inputs for a field probe from kw&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">probe_geometry</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;probe_geometry&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">x_probe</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;x_probe&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y_probe</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;y_probe&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">z_probe</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;z_probe&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">interp_order</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;interp_order&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;integrate&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_moving_window_FP</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;do_moving_window_FP&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">probe_geometry</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">!=</span> <span class="s1">&#39;point&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;resolution&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">probe_geometry</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;line&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">x1_probe</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;x1_probe&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">y1_probe</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;y1_probe&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">z1_probe</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;z1_probe&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">probe_geometry</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;plane&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detector_radius</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;detector_radius&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">target_normal_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;target_normal_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_normal_y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;target_normal_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_normal_z</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;target_normal_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">target_up_x</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;target_up_x&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_up_y</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;target_up_y&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_up_z</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;target_up_z&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">kw</span>

    <span class="k">def</span> <span class="nf">_handle_particle_histogram</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_number</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;bin_number&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_max</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;bin_max&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bin_min</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;bin_min&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;normalization&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalization</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;unity_particle_weight&quot;</span><span class="p">,</span> <span class="s2">&quot;max_to_unity&quot;</span><span class="p">,</span> <span class="s2">&quot;area_to_unity&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span>
               <span class="s2">&quot;The ParticleHistogram normalization must be one of &#39;unity_particle_weight&#39;, &#39;max_to_unity&#39;, or &#39;area_to_unity&#39;&quot;</span><span class="p">)</span>

        <span class="n">histogram_function</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;histogram_function&quot;</span><span class="p">)</span>
        <span class="n">filter_function</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;filter_function&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;histogram_function(t,x,y,z,ux,uy,uz)&quot;</span><span class="p">,</span> <span class="n">histogram_function</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;filter_function(t,x,y,z,ux,uy,uz)&quot;</span><span class="p">,</span> <span class="n">filter_function</span><span class="p">)</span>

        <span class="c1"># Check the reduced function expressions for constants</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b</span><span class="si">%s</span><span class="s1">\b&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">,</span> <span class="n">histogram_function</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">(</span><span class="n">filter_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b</span><span class="si">%s</span><span class="s1">\b&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">,</span> <span class="n">filter_function</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">kw</span>

    <span class="k">def</span> <span class="nf">_handle_field_reduction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reduction_type</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;reduction_type&quot;</span><span class="p">)</span>
        <span class="n">reduced_function</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;reduced_function&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;reduced_function(x,y,z,Ex,Ey,Ez,Bx,By,Bz,jx,jy,jz)&quot;</span><span class="p">,</span> <span class="n">reduced_function</span><span class="p">)</span>

        <span class="c1"># Check the reduced function expression for constants</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b</span><span class="si">%s</span><span class="s1">\b&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">,</span> <span class="n">reduced_function</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">kw</span>

    <span class="k">def</span> <span class="nf">_handle_charge_on_eb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="n">weighting_function</span> <span class="o">=</span> <span class="n">kw</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s2">&quot;weighting_function&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="s2">&quot;weighting_function(x,y,z)&quot;</span><span class="p">,</span> <span class="n">weighting_function</span><span class="p">)</span>

        <span class="c1"># Check the reduced function expression for constants</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">kw</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\b</span><span class="si">%s</span><span class="s1">\b&#39;</span><span class="o">%</span><span class="n">k</span><span class="p">,</span> <span class="n">weighting_function</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kw</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">kw</span>

    <span class="k">def</span> <span class="nf">initialize_inputs</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">add_diagnostic</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">add_keywords</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">user_defined_kw</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;diagnostic&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">):</span>
                    <span class="c1"># Analytic expressions require processing to deal with constants</span>
                    <span class="n">expression</span> <span class="o">=</span> <span class="n">pywarpx</span><span class="o">.</span><span class="n">my_constants</span><span class="o">.</span><span class="n">mangle_expression</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mangle_dict</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">expression</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">diagnostic</span><span class="o">.</span><span class="fm">__setattr__</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2022, WarpX-ARTEMIS collaboration.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>